{"ast":null,"code":"var Path = require(\"../graphic/Path\");\n\nvar PathProxy = require(\"../core/PathProxy\");\n\nvar transformPath = require(\"./transformPath\"); // command chars\n// var cc = [\n//     'm', 'M', 'l', 'L', 'v', 'V', 'h', 'H', 'z', 'Z',\n//     'c', 'C', 'q', 'Q', 't', 'T', 's', 'S', 'a', 'A'\n// ];\n\n\nvar mathSqrt = Math.sqrt;\nvar mathSin = Math.sin;\nvar mathCos = Math.cos;\nvar PI = Math.PI;\n\nvar vMag = function vMag(v) {\n  return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n};\n\nvar vRatio = function vRatio(u, v) {\n  return (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v));\n};\n\nvar vAngle = function vAngle(u, v) {\n  return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));\n};\n\nfunction processArc(x1, y1, x2, y2, fa, fs, rx, ry, psiDeg, cmd, path) {\n  var psi = psiDeg * (PI / 180.0);\n  var xp = mathCos(psi) * (x1 - x2) / 2.0 + mathSin(psi) * (y1 - y2) / 2.0;\n  var yp = -1 * mathSin(psi) * (x1 - x2) / 2.0 + mathCos(psi) * (y1 - y2) / 2.0;\n  var lambda = xp * xp / (rx * rx) + yp * yp / (ry * ry);\n\n  if (lambda > 1) {\n    rx *= mathSqrt(lambda);\n    ry *= mathSqrt(lambda);\n  }\n\n  var f = (fa === fs ? -1 : 1) * mathSqrt((rx * rx * (ry * ry) - rx * rx * (yp * yp) - ry * ry * (xp * xp)) / (rx * rx * (yp * yp) + ry * ry * (xp * xp))) || 0;\n  var cxp = f * rx * yp / ry;\n  var cyp = f * -ry * xp / rx;\n  var cx = (x1 + x2) / 2.0 + mathCos(psi) * cxp - mathSin(psi) * cyp;\n  var cy = (y1 + y2) / 2.0 + mathSin(psi) * cxp + mathCos(psi) * cyp;\n  var theta = vAngle([1, 0], [(xp - cxp) / rx, (yp - cyp) / ry]);\n  var u = [(xp - cxp) / rx, (yp - cyp) / ry];\n  var v = [(-1 * xp - cxp) / rx, (-1 * yp - cyp) / ry];\n  var dTheta = vAngle(u, v);\n\n  if (vRatio(u, v) <= -1) {\n    dTheta = PI;\n  }\n\n  if (vRatio(u, v) >= 1) {\n    dTheta = 0;\n  }\n\n  if (fs === 0 && dTheta > 0) {\n    dTheta = dTheta - 2 * PI;\n  }\n\n  if (fs === 1 && dTheta < 0) {\n    dTheta = dTheta + 2 * PI;\n  }\n\n  path.addData(cmd, cx, cy, rx, ry, theta, dTheta, psi, fs);\n}\n\nvar commandReg = /([mlvhzcqtsa])([^mlvhzcqtsa]*)/ig; // Consider case:\n// (1) delimiter can be comma or space, where continuous commas\n// or spaces should be seen as one comma.\n// (2) value can be like:\n// '2e-4', 'l.5.9' (ignore 0), 'M-10-10', 'l-2.43e-1,34.9983',\n// 'l-.5E1,54', '121-23-44-11' (no delimiter)\n\nvar numberReg = /-?([0-9]*\\.)?[0-9]+([eE]-?[0-9]+)?/g; // var valueSplitReg = /[\\s,]+/;\n\nfunction createPathProxyFromString(data) {\n  if (!data) {\n    return new PathProxy();\n  } // var data = data.replace(/-/g, ' -')\n  //     .replace(/  /g, ' ')\n  //     .replace(/ /g, ',')\n  //     .replace(/,,/g, ',');\n  // var n;\n  // create pipes so that we can split the data\n  // for (n = 0; n < cc.length; n++) {\n  //     cs = cs.replace(new RegExp(cc[n], 'g'), '|' + cc[n]);\n  // }\n  // data = data.replace(/-/g, ',-');\n  // create array\n  // var arr = cs.split('|');\n  // init context point\n\n\n  var cpx = 0;\n  var cpy = 0;\n  var subpathX = cpx;\n  var subpathY = cpy;\n  var prevCmd;\n  var path = new PathProxy();\n  var CMD = PathProxy.CMD; // commandReg.lastIndex = 0;\n  // var cmdResult;\n  // while ((cmdResult = commandReg.exec(data)) != null) {\n  //     var cmdStr = cmdResult[1];\n  //     var cmdContent = cmdResult[2];\n\n  var cmdList = data.match(commandReg);\n\n  for (var l = 0; l < cmdList.length; l++) {\n    var cmdText = cmdList[l];\n    var cmdStr = cmdText.charAt(0);\n    var cmd; // String#split is faster a little bit than String#replace or RegExp#exec.\n    // var p = cmdContent.split(valueSplitReg);\n    // var pLen = 0;\n    // for (var i = 0; i < p.length; i++) {\n    //     // '' and other invalid str => NaN\n    //     var val = parseFloat(p[i]);\n    //     !isNaN(val) && (p[pLen++] = val);\n    // }\n\n    var p = cmdText.match(numberReg) || [];\n    var pLen = p.length;\n\n    for (var i = 0; i < pLen; i++) {\n      p[i] = parseFloat(p[i]);\n    }\n\n    var off = 0;\n\n    while (off < pLen) {\n      var ctlPtx;\n      var ctlPty;\n      var rx;\n      var ry;\n      var psi;\n      var fa;\n      var fs;\n      var x1 = cpx;\n      var y1 = cpy; // convert l, H, h, V, and v to L\n\n      switch (cmdStr) {\n        case 'l':\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'L':\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'm':\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.M;\n          path.addData(cmd, cpx, cpy);\n          subpathX = cpx;\n          subpathY = cpy;\n          cmdStr = 'l';\n          break;\n\n        case 'M':\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.M;\n          path.addData(cmd, cpx, cpy);\n          subpathX = cpx;\n          subpathY = cpy;\n          cmdStr = 'L';\n          break;\n\n        case 'h':\n          cpx += p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'H':\n          cpx = p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'v':\n          cpy += p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'V':\n          cpy = p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'C':\n          cmd = CMD.C;\n          path.addData(cmd, p[off++], p[off++], p[off++], p[off++], p[off++], p[off++]);\n          cpx = p[off - 2];\n          cpy = p[off - 1];\n          break;\n\n        case 'c':\n          cmd = CMD.C;\n          path.addData(cmd, p[off++] + cpx, p[off++] + cpy, p[off++] + cpx, p[off++] + cpy, p[off++] + cpx, p[off++] + cpy);\n          cpx += p[off - 2];\n          cpy += p[off - 1];\n          break;\n\n        case 'S':\n          ctlPtx = cpx;\n          ctlPty = cpy;\n          var len = path.len();\n          var pathData = path.data;\n\n          if (prevCmd === CMD.C) {\n            ctlPtx += cpx - pathData[len - 4];\n            ctlPty += cpy - pathData[len - 3];\n          }\n\n          cmd = CMD.C;\n          x1 = p[off++];\n          y1 = p[off++];\n          cpx = p[off++];\n          cpy = p[off++];\n          path.addData(cmd, ctlPtx, ctlPty, x1, y1, cpx, cpy);\n          break;\n\n        case 's':\n          ctlPtx = cpx;\n          ctlPty = cpy;\n          var len = path.len();\n          var pathData = path.data;\n\n          if (prevCmd === CMD.C) {\n            ctlPtx += cpx - pathData[len - 4];\n            ctlPty += cpy - pathData[len - 3];\n          }\n\n          cmd = CMD.C;\n          x1 = cpx + p[off++];\n          y1 = cpy + p[off++];\n          cpx += p[off++];\n          cpy += p[off++];\n          path.addData(cmd, ctlPtx, ctlPty, x1, y1, cpx, cpy);\n          break;\n\n        case 'Q':\n          x1 = p[off++];\n          y1 = p[off++];\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.Q;\n          path.addData(cmd, x1, y1, cpx, cpy);\n          break;\n\n        case 'q':\n          x1 = p[off++] + cpx;\n          y1 = p[off++] + cpy;\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.Q;\n          path.addData(cmd, x1, y1, cpx, cpy);\n          break;\n\n        case 'T':\n          ctlPtx = cpx;\n          ctlPty = cpy;\n          var len = path.len();\n          var pathData = path.data;\n\n          if (prevCmd === CMD.Q) {\n            ctlPtx += cpx - pathData[len - 4];\n            ctlPty += cpy - pathData[len - 3];\n          }\n\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.Q;\n          path.addData(cmd, ctlPtx, ctlPty, cpx, cpy);\n          break;\n\n        case 't':\n          ctlPtx = cpx;\n          ctlPty = cpy;\n          var len = path.len();\n          var pathData = path.data;\n\n          if (prevCmd === CMD.Q) {\n            ctlPtx += cpx - pathData[len - 4];\n            ctlPty += cpy - pathData[len - 3];\n          }\n\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.Q;\n          path.addData(cmd, ctlPtx, ctlPty, cpx, cpy);\n          break;\n\n        case 'A':\n          rx = p[off++];\n          ry = p[off++];\n          psi = p[off++];\n          fa = p[off++];\n          fs = p[off++];\n          x1 = cpx, y1 = cpy;\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.A;\n          processArc(x1, y1, cpx, cpy, fa, fs, rx, ry, psi, cmd, path);\n          break;\n\n        case 'a':\n          rx = p[off++];\n          ry = p[off++];\n          psi = p[off++];\n          fa = p[off++];\n          fs = p[off++];\n          x1 = cpx, y1 = cpy;\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.A;\n          processArc(x1, y1, cpx, cpy, fa, fs, rx, ry, psi, cmd, path);\n          break;\n      }\n    }\n\n    if (cmdStr === 'z' || cmdStr === 'Z') {\n      cmd = CMD.Z;\n      path.addData(cmd); // z may be in the middle of the path.\n\n      cpx = subpathX;\n      cpy = subpathY;\n    }\n\n    prevCmd = cmd;\n  }\n\n  path.toStatic();\n  return path;\n} // TODO Optimize double memory cost problem\n\n\nfunction createPathOptions(str, opts) {\n  var pathProxy = createPathProxyFromString(str);\n  opts = opts || {};\n\n  opts.buildPath = function (path) {\n    if (path.setData) {\n      path.setData(pathProxy.data); // Svg and vml renderer don't have context\n\n      var ctx = path.getContext();\n\n      if (ctx) {\n        path.rebuildPath(ctx);\n      }\n    } else {\n      var ctx = path;\n      pathProxy.rebuildPath(ctx);\n    }\n  };\n\n  opts.applyTransform = function (m) {\n    transformPath(pathProxy, m);\n    this.dirty(true);\n  };\n\n  return opts;\n}\n/**\n * Create a Path object from path string data\n * http://www.w3.org/TR/SVG/paths.html#PathData\n * @param  {Object} opts Other options\n */\n\n\nfunction createFromString(str, opts) {\n  return new Path(createPathOptions(str, opts));\n}\n/**\n * Create a Path class from path string data\n * @param  {string} str\n * @param  {Object} opts Other options\n */\n\n\nfunction extendFromString(str, opts) {\n  return Path.extend(createPathOptions(str, opts));\n}\n/**\n * Merge multiple paths\n */\n// TODO Apply transform\n// TODO stroke dash\n// TODO Optimize double memory cost problem\n\n\nfunction mergePath(pathEls, opts) {\n  var pathList = [];\n  var len = pathEls.length;\n\n  for (var i = 0; i < len; i++) {\n    var pathEl = pathEls[i];\n\n    if (!pathEl.path) {\n      pathEl.createPathProxy();\n    }\n\n    if (pathEl.__dirtyPath) {\n      pathEl.buildPath(pathEl.path, pathEl.shape, true);\n    }\n\n    pathList.push(pathEl.path);\n  }\n\n  var pathBundle = new Path(opts); // Need path proxy.\n\n  pathBundle.createPathProxy();\n\n  pathBundle.buildPath = function (path) {\n    path.appendPath(pathList); // Svg and vml renderer don't have context\n\n    var ctx = path.getContext();\n\n    if (ctx) {\n      path.rebuildPath(ctx);\n    }\n  };\n\n  return pathBundle;\n}\n\nexports.createFromString = createFromString;\nexports.extendFromString = extendFromString;\nexports.mergePath = mergePath;","map":{"version":3,"sources":["/home/johnatan/MP/mp-app/ap/node_modules/zrender/lib/tool/path.js"],"names":["Path","require","PathProxy","transformPath","mathSqrt","Math","sqrt","mathSin","sin","mathCos","cos","PI","vMag","v","vRatio","u","vAngle","acos","processArc","x1","y1","x2","y2","fa","fs","rx","ry","psiDeg","cmd","path","psi","xp","yp","lambda","f","cxp","cyp","cx","cy","theta","dTheta","addData","commandReg","numberReg","createPathProxyFromString","data","cpx","cpy","subpathX","subpathY","prevCmd","CMD","cmdList","match","l","length","cmdText","cmdStr","charAt","p","pLen","i","parseFloat","off","ctlPtx","ctlPty","L","M","C","len","pathData","Q","A","Z","toStatic","createPathOptions","str","opts","pathProxy","buildPath","setData","ctx","getContext","rebuildPath","applyTransform","m","dirty","createFromString","extendFromString","extend","mergePath","pathEls","pathList","pathEl","createPathProxy","__dirtyPath","shape","push","pathBundle","appendPath","exports"],"mappings":"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","sourcesContent":["var Path = require(\"../graphic/Path\");\n\nvar PathProxy = require(\"../core/PathProxy\");\n\nvar transformPath = require(\"./transformPath\");\n\n// command chars\n// var cc = [\n//     'm', 'M', 'l', 'L', 'v', 'V', 'h', 'H', 'z', 'Z',\n//     'c', 'C', 'q', 'Q', 't', 'T', 's', 'S', 'a', 'A'\n// ];\nvar mathSqrt = Math.sqrt;\nvar mathSin = Math.sin;\nvar mathCos = Math.cos;\nvar PI = Math.PI;\n\nvar vMag = function (v) {\n  return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n};\n\nvar vRatio = function (u, v) {\n  return (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v));\n};\n\nvar vAngle = function (u, v) {\n  return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));\n};\n\nfunction processArc(x1, y1, x2, y2, fa, fs, rx, ry, psiDeg, cmd, path) {\n  var psi = psiDeg * (PI / 180.0);\n  var xp = mathCos(psi) * (x1 - x2) / 2.0 + mathSin(psi) * (y1 - y2) / 2.0;\n  var yp = -1 * mathSin(psi) * (x1 - x2) / 2.0 + mathCos(psi) * (y1 - y2) / 2.0;\n  var lambda = xp * xp / (rx * rx) + yp * yp / (ry * ry);\n\n  if (lambda > 1) {\n    rx *= mathSqrt(lambda);\n    ry *= mathSqrt(lambda);\n  }\n\n  var f = (fa === fs ? -1 : 1) * mathSqrt((rx * rx * (ry * ry) - rx * rx * (yp * yp) - ry * ry * (xp * xp)) / (rx * rx * (yp * yp) + ry * ry * (xp * xp))) || 0;\n  var cxp = f * rx * yp / ry;\n  var cyp = f * -ry * xp / rx;\n  var cx = (x1 + x2) / 2.0 + mathCos(psi) * cxp - mathSin(psi) * cyp;\n  var cy = (y1 + y2) / 2.0 + mathSin(psi) * cxp + mathCos(psi) * cyp;\n  var theta = vAngle([1, 0], [(xp - cxp) / rx, (yp - cyp) / ry]);\n  var u = [(xp - cxp) / rx, (yp - cyp) / ry];\n  var v = [(-1 * xp - cxp) / rx, (-1 * yp - cyp) / ry];\n  var dTheta = vAngle(u, v);\n\n  if (vRatio(u, v) <= -1) {\n    dTheta = PI;\n  }\n\n  if (vRatio(u, v) >= 1) {\n    dTheta = 0;\n  }\n\n  if (fs === 0 && dTheta > 0) {\n    dTheta = dTheta - 2 * PI;\n  }\n\n  if (fs === 1 && dTheta < 0) {\n    dTheta = dTheta + 2 * PI;\n  }\n\n  path.addData(cmd, cx, cy, rx, ry, theta, dTheta, psi, fs);\n}\n\nvar commandReg = /([mlvhzcqtsa])([^mlvhzcqtsa]*)/ig; // Consider case:\n// (1) delimiter can be comma or space, where continuous commas\n// or spaces should be seen as one comma.\n// (2) value can be like:\n// '2e-4', 'l.5.9' (ignore 0), 'M-10-10', 'l-2.43e-1,34.9983',\n// 'l-.5E1,54', '121-23-44-11' (no delimiter)\n\nvar numberReg = /-?([0-9]*\\.)?[0-9]+([eE]-?[0-9]+)?/g; // var valueSplitReg = /[\\s,]+/;\n\nfunction createPathProxyFromString(data) {\n  if (!data) {\n    return new PathProxy();\n  } // var data = data.replace(/-/g, ' -')\n  //     .replace(/  /g, ' ')\n  //     .replace(/ /g, ',')\n  //     .replace(/,,/g, ',');\n  // var n;\n  // create pipes so that we can split the data\n  // for (n = 0; n < cc.length; n++) {\n  //     cs = cs.replace(new RegExp(cc[n], 'g'), '|' + cc[n]);\n  // }\n  // data = data.replace(/-/g, ',-');\n  // create array\n  // var arr = cs.split('|');\n  // init context point\n\n\n  var cpx = 0;\n  var cpy = 0;\n  var subpathX = cpx;\n  var subpathY = cpy;\n  var prevCmd;\n  var path = new PathProxy();\n  var CMD = PathProxy.CMD; // commandReg.lastIndex = 0;\n  // var cmdResult;\n  // while ((cmdResult = commandReg.exec(data)) != null) {\n  //     var cmdStr = cmdResult[1];\n  //     var cmdContent = cmdResult[2];\n\n  var cmdList = data.match(commandReg);\n\n  for (var l = 0; l < cmdList.length; l++) {\n    var cmdText = cmdList[l];\n    var cmdStr = cmdText.charAt(0);\n    var cmd; // String#split is faster a little bit than String#replace or RegExp#exec.\n    // var p = cmdContent.split(valueSplitReg);\n    // var pLen = 0;\n    // for (var i = 0; i < p.length; i++) {\n    //     // '' and other invalid str => NaN\n    //     var val = parseFloat(p[i]);\n    //     !isNaN(val) && (p[pLen++] = val);\n    // }\n\n    var p = cmdText.match(numberReg) || [];\n    var pLen = p.length;\n\n    for (var i = 0; i < pLen; i++) {\n      p[i] = parseFloat(p[i]);\n    }\n\n    var off = 0;\n\n    while (off < pLen) {\n      var ctlPtx;\n      var ctlPty;\n      var rx;\n      var ry;\n      var psi;\n      var fa;\n      var fs;\n      var x1 = cpx;\n      var y1 = cpy; // convert l, H, h, V, and v to L\n\n      switch (cmdStr) {\n        case 'l':\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'L':\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'm':\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.M;\n          path.addData(cmd, cpx, cpy);\n          subpathX = cpx;\n          subpathY = cpy;\n          cmdStr = 'l';\n          break;\n\n        case 'M':\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.M;\n          path.addData(cmd, cpx, cpy);\n          subpathX = cpx;\n          subpathY = cpy;\n          cmdStr = 'L';\n          break;\n\n        case 'h':\n          cpx += p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'H':\n          cpx = p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'v':\n          cpy += p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'V':\n          cpy = p[off++];\n          cmd = CMD.L;\n          path.addData(cmd, cpx, cpy);\n          break;\n\n        case 'C':\n          cmd = CMD.C;\n          path.addData(cmd, p[off++], p[off++], p[off++], p[off++], p[off++], p[off++]);\n          cpx = p[off - 2];\n          cpy = p[off - 1];\n          break;\n\n        case 'c':\n          cmd = CMD.C;\n          path.addData(cmd, p[off++] + cpx, p[off++] + cpy, p[off++] + cpx, p[off++] + cpy, p[off++] + cpx, p[off++] + cpy);\n          cpx += p[off - 2];\n          cpy += p[off - 1];\n          break;\n\n        case 'S':\n          ctlPtx = cpx;\n          ctlPty = cpy;\n          var len = path.len();\n          var pathData = path.data;\n\n          if (prevCmd === CMD.C) {\n            ctlPtx += cpx - pathData[len - 4];\n            ctlPty += cpy - pathData[len - 3];\n          }\n\n          cmd = CMD.C;\n          x1 = p[off++];\n          y1 = p[off++];\n          cpx = p[off++];\n          cpy = p[off++];\n          path.addData(cmd, ctlPtx, ctlPty, x1, y1, cpx, cpy);\n          break;\n\n        case 's':\n          ctlPtx = cpx;\n          ctlPty = cpy;\n          var len = path.len();\n          var pathData = path.data;\n\n          if (prevCmd === CMD.C) {\n            ctlPtx += cpx - pathData[len - 4];\n            ctlPty += cpy - pathData[len - 3];\n          }\n\n          cmd = CMD.C;\n          x1 = cpx + p[off++];\n          y1 = cpy + p[off++];\n          cpx += p[off++];\n          cpy += p[off++];\n          path.addData(cmd, ctlPtx, ctlPty, x1, y1, cpx, cpy);\n          break;\n\n        case 'Q':\n          x1 = p[off++];\n          y1 = p[off++];\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.Q;\n          path.addData(cmd, x1, y1, cpx, cpy);\n          break;\n\n        case 'q':\n          x1 = p[off++] + cpx;\n          y1 = p[off++] + cpy;\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.Q;\n          path.addData(cmd, x1, y1, cpx, cpy);\n          break;\n\n        case 'T':\n          ctlPtx = cpx;\n          ctlPty = cpy;\n          var len = path.len();\n          var pathData = path.data;\n\n          if (prevCmd === CMD.Q) {\n            ctlPtx += cpx - pathData[len - 4];\n            ctlPty += cpy - pathData[len - 3];\n          }\n\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.Q;\n          path.addData(cmd, ctlPtx, ctlPty, cpx, cpy);\n          break;\n\n        case 't':\n          ctlPtx = cpx;\n          ctlPty = cpy;\n          var len = path.len();\n          var pathData = path.data;\n\n          if (prevCmd === CMD.Q) {\n            ctlPtx += cpx - pathData[len - 4];\n            ctlPty += cpy - pathData[len - 3];\n          }\n\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.Q;\n          path.addData(cmd, ctlPtx, ctlPty, cpx, cpy);\n          break;\n\n        case 'A':\n          rx = p[off++];\n          ry = p[off++];\n          psi = p[off++];\n          fa = p[off++];\n          fs = p[off++];\n          x1 = cpx, y1 = cpy;\n          cpx = p[off++];\n          cpy = p[off++];\n          cmd = CMD.A;\n          processArc(x1, y1, cpx, cpy, fa, fs, rx, ry, psi, cmd, path);\n          break;\n\n        case 'a':\n          rx = p[off++];\n          ry = p[off++];\n          psi = p[off++];\n          fa = p[off++];\n          fs = p[off++];\n          x1 = cpx, y1 = cpy;\n          cpx += p[off++];\n          cpy += p[off++];\n          cmd = CMD.A;\n          processArc(x1, y1, cpx, cpy, fa, fs, rx, ry, psi, cmd, path);\n          break;\n      }\n    }\n\n    if (cmdStr === 'z' || cmdStr === 'Z') {\n      cmd = CMD.Z;\n      path.addData(cmd); // z may be in the middle of the path.\n\n      cpx = subpathX;\n      cpy = subpathY;\n    }\n\n    prevCmd = cmd;\n  }\n\n  path.toStatic();\n  return path;\n} // TODO Optimize double memory cost problem\n\n\nfunction createPathOptions(str, opts) {\n  var pathProxy = createPathProxyFromString(str);\n  opts = opts || {};\n\n  opts.buildPath = function (path) {\n    if (path.setData) {\n      path.setData(pathProxy.data); // Svg and vml renderer don't have context\n\n      var ctx = path.getContext();\n\n      if (ctx) {\n        path.rebuildPath(ctx);\n      }\n    } else {\n      var ctx = path;\n      pathProxy.rebuildPath(ctx);\n    }\n  };\n\n  opts.applyTransform = function (m) {\n    transformPath(pathProxy, m);\n    this.dirty(true);\n  };\n\n  return opts;\n}\n/**\n * Create a Path object from path string data\n * http://www.w3.org/TR/SVG/paths.html#PathData\n * @param  {Object} opts Other options\n */\n\n\nfunction createFromString(str, opts) {\n  return new Path(createPathOptions(str, opts));\n}\n/**\n * Create a Path class from path string data\n * @param  {string} str\n * @param  {Object} opts Other options\n */\n\n\nfunction extendFromString(str, opts) {\n  return Path.extend(createPathOptions(str, opts));\n}\n/**\n * Merge multiple paths\n */\n// TODO Apply transform\n// TODO stroke dash\n// TODO Optimize double memory cost problem\n\n\nfunction mergePath(pathEls, opts) {\n  var pathList = [];\n  var len = pathEls.length;\n\n  for (var i = 0; i < len; i++) {\n    var pathEl = pathEls[i];\n\n    if (!pathEl.path) {\n      pathEl.createPathProxy();\n    }\n\n    if (pathEl.__dirtyPath) {\n      pathEl.buildPath(pathEl.path, pathEl.shape, true);\n    }\n\n    pathList.push(pathEl.path);\n  }\n\n  var pathBundle = new Path(opts); // Need path proxy.\n\n  pathBundle.createPathProxy();\n\n  pathBundle.buildPath = function (path) {\n    path.appendPath(pathList); // Svg and vml renderer don't have context\n\n    var ctx = path.getContext();\n\n    if (ctx) {\n      path.rebuildPath(ctx);\n    }\n  };\n\n  return pathBundle;\n}\n\nexports.createFromString = createFromString;\nexports.extendFromString = extendFromString;\nexports.mergePath = mergePath;"]},"metadata":{},"sourceType":"script"}