{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar zrUtil = require(\"zrender/lib/core/util\");\n\nvar layout = require(\"../../util/layout\");\n\nvar numberUtil = require(\"../../util/number\");\n\nvar CoordinateSystem = require(\"../../CoordinateSystem\");\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// (24*60*60*1000)\n\n\nvar PROXIMATE_ONE_DAY = 86400000;\n/**\n * Calendar\n *\n * @constructor\n *\n * @param {Object} calendarModel calendarModel\n * @param {Object} ecModel       ecModel\n * @param {Object} api           api\n */\n\nfunction Calendar(calendarModel, ecModel, api) {\n  this._model = calendarModel;\n}\n\nCalendar.prototype = {\n  constructor: Calendar,\n  type: 'calendar',\n  dimensions: ['time', 'value'],\n  // Required in createListFromData\n  getDimensionsInfo: function getDimensionsInfo() {\n    return [{\n      name: 'time',\n      type: 'time'\n    }, 'value'];\n  },\n  getRangeInfo: function getRangeInfo() {\n    return this._rangeInfo;\n  },\n  getModel: function getModel() {\n    return this._model;\n  },\n  getRect: function getRect() {\n    return this._rect;\n  },\n  getCellWidth: function getCellWidth() {\n    return this._sw;\n  },\n  getCellHeight: function getCellHeight() {\n    return this._sh;\n  },\n  getOrient: function getOrient() {\n    return this._orient;\n  },\n\n  /**\n   * getFirstDayOfWeek\n   *\n   * @example\n   *     0 : start at Sunday\n   *     1 : start at Monday\n   *\n   * @return {number}\n   */\n  getFirstDayOfWeek: function getFirstDayOfWeek() {\n    return this._firstDayOfWeek;\n  },\n\n  /**\n   * get date info\n   *\n   * @param  {string|number} date date\n   * @return {Object}\n   * {\n   *      y: string, local full year, eg., '1940',\n   *      m: string, local month, from '01' ot '12',\n   *      d: string, local date, from '01' to '31' (if exists),\n   *      day: It is not date.getDay(). It is the location of the cell in a week, from 0 to 6,\n   *      time: timestamp,\n   *      formatedDate: string, yyyy-MM-dd,\n   *      date: original date object.\n   * }\n   */\n  getDateInfo: function getDateInfo(date) {\n    date = numberUtil.parseDate(date);\n    var y = date.getFullYear();\n    var m = date.getMonth() + 1;\n    m = m < 10 ? '0' + m : m;\n    var d = date.getDate();\n    d = d < 10 ? '0' + d : d;\n    var day = date.getDay();\n    day = Math.abs((day + 7 - this.getFirstDayOfWeek()) % 7);\n    return {\n      y: y,\n      m: m,\n      d: d,\n      day: day,\n      time: date.getTime(),\n      formatedDate: y + '-' + m + '-' + d,\n      date: date\n    };\n  },\n  getNextNDay: function getNextNDay(date, n) {\n    n = n || 0;\n\n    if (n === 0) {\n      return this.getDateInfo(date);\n    }\n\n    date = new Date(this.getDateInfo(date).time);\n    date.setDate(date.getDate() + n);\n    return this.getDateInfo(date);\n  },\n  update: function update(ecModel, api) {\n    this._firstDayOfWeek = +this._model.getModel('dayLabel').get('firstDay');\n    this._orient = this._model.get('orient');\n    this._lineWidth = this._model.getModel('itemStyle').getItemStyle().lineWidth || 0;\n    this._rangeInfo = this._getRangeInfo(this._initRangeOption());\n    var weeks = this._rangeInfo.weeks || 1;\n    var whNames = ['width', 'height'];\n\n    var cellSize = this._model.get('cellSize').slice();\n\n    var layoutParams = this._model.getBoxLayoutParams();\n\n    var cellNumbers = this._orient === 'horizontal' ? [weeks, 7] : [7, weeks];\n    zrUtil.each([0, 1], function (idx) {\n      if (cellSizeSpecified(cellSize, idx)) {\n        layoutParams[whNames[idx]] = cellSize[idx] * cellNumbers[idx];\n      }\n    });\n    var whGlobal = {\n      width: api.getWidth(),\n      height: api.getHeight()\n    };\n    var calendarRect = this._rect = layout.getLayoutRect(layoutParams, whGlobal);\n    zrUtil.each([0, 1], function (idx) {\n      if (!cellSizeSpecified(cellSize, idx)) {\n        cellSize[idx] = calendarRect[whNames[idx]] / cellNumbers[idx];\n      }\n    });\n\n    function cellSizeSpecified(cellSize, idx) {\n      return cellSize[idx] != null && cellSize[idx] !== 'auto';\n    }\n\n    this._sw = cellSize[0];\n    this._sh = cellSize[1];\n  },\n\n  /**\n   * Convert a time data(time, value) item to (x, y) point.\n   *\n   * @override\n   * @param  {Array|number} data data\n   * @param  {boolean} [clamp=true] out of range\n   * @return {Array} point\n   */\n  dataToPoint: function dataToPoint(data, clamp) {\n    zrUtil.isArray(data) && (data = data[0]);\n    clamp == null && (clamp = true);\n    var dayInfo = this.getDateInfo(data);\n    var range = this._rangeInfo;\n    var date = dayInfo.formatedDate; // if not in range return [NaN, NaN]\n\n    if (clamp && !(dayInfo.time >= range.start.time && dayInfo.time < range.end.time + PROXIMATE_ONE_DAY)) {\n      return [NaN, NaN];\n    }\n\n    var week = dayInfo.day;\n\n    var nthWeek = this._getRangeInfo([range.start.time, date]).nthWeek;\n\n    if (this._orient === 'vertical') {\n      return [this._rect.x + week * this._sw + this._sw / 2, this._rect.y + nthWeek * this._sh + this._sh / 2];\n    }\n\n    return [this._rect.x + nthWeek * this._sw + this._sw / 2, this._rect.y + week * this._sh + this._sh / 2];\n  },\n\n  /**\n   * Convert a (x, y) point to time data\n   *\n   * @override\n   * @param  {string} point point\n   * @return {string}       data\n   */\n  pointToData: function pointToData(point) {\n    var date = this.pointToDate(point);\n    return date && date.time;\n  },\n\n  /**\n   * Convert a time date item to (x, y) four point.\n   *\n   * @param  {Array} data  date[0] is date\n   * @param  {boolean} [clamp=true]  out of range\n   * @return {Object}       point\n   */\n  dataToRect: function dataToRect(data, clamp) {\n    var point = this.dataToPoint(data, clamp);\n    return {\n      contentShape: {\n        x: point[0] - (this._sw - this._lineWidth) / 2,\n        y: point[1] - (this._sh - this._lineWidth) / 2,\n        width: this._sw - this._lineWidth,\n        height: this._sh - this._lineWidth\n      },\n      center: point,\n      tl: [point[0] - this._sw / 2, point[1] - this._sh / 2],\n      tr: [point[0] + this._sw / 2, point[1] - this._sh / 2],\n      br: [point[0] + this._sw / 2, point[1] + this._sh / 2],\n      bl: [point[0] - this._sw / 2, point[1] + this._sh / 2]\n    };\n  },\n\n  /**\n   * Convert a (x, y) point to time date\n   *\n   * @param  {Array} point point\n   * @return {Object}       date\n   */\n  pointToDate: function pointToDate(point) {\n    var nthX = Math.floor((point[0] - this._rect.x) / this._sw) + 1;\n    var nthY = Math.floor((point[1] - this._rect.y) / this._sh) + 1;\n    var range = this._rangeInfo.range;\n\n    if (this._orient === 'vertical') {\n      return this._getDateByWeeksAndDay(nthY, nthX - 1, range);\n    }\n\n    return this._getDateByWeeksAndDay(nthX, nthY - 1, range);\n  },\n\n  /**\n   * @inheritDoc\n   */\n  convertToPixel: zrUtil.curry(doConvert, 'dataToPoint'),\n\n  /**\n   * @inheritDoc\n   */\n  convertFromPixel: zrUtil.curry(doConvert, 'pointToData'),\n\n  /**\n   * initRange\n   *\n   * @private\n   * @return {Array} [start, end]\n   */\n  _initRangeOption: function _initRangeOption() {\n    var range = this._model.get('range');\n\n    var rg = range;\n\n    if (zrUtil.isArray(rg) && rg.length === 1) {\n      rg = rg[0];\n    }\n\n    if (/^\\d{4}$/.test(rg)) {\n      range = [rg + '-01-01', rg + '-12-31'];\n    }\n\n    if (/^\\d{4}[\\/|-]\\d{1,2}$/.test(rg)) {\n      var start = this.getDateInfo(rg);\n      var firstDay = start.date;\n      firstDay.setMonth(firstDay.getMonth() + 1);\n      var end = this.getNextNDay(firstDay, -1);\n      range = [start.formatedDate, end.formatedDate];\n    }\n\n    if (/^\\d{4}[\\/|-]\\d{1,2}[\\/|-]\\d{1,2}$/.test(rg)) {\n      range = [rg, rg];\n    }\n\n    var tmp = this._getRangeInfo(range);\n\n    if (tmp.start.time > tmp.end.time) {\n      range.reverse();\n    }\n\n    return range;\n  },\n\n  /**\n   * range info\n   *\n   * @private\n   * @param  {Array} range range ['2017-01-01', '2017-07-08']\n   *  If range[0] > range[1], they will not be reversed.\n   * @return {Object}       obj\n   */\n  _getRangeInfo: function _getRangeInfo(range) {\n    range = [this.getDateInfo(range[0]), this.getDateInfo(range[1])];\n    var reversed;\n\n    if (range[0].time > range[1].time) {\n      reversed = true;\n      range.reverse();\n    }\n\n    var allDay = Math.floor(range[1].time / PROXIMATE_ONE_DAY) - Math.floor(range[0].time / PROXIMATE_ONE_DAY) + 1; // Consider case1 (#11677 #10430):\n    // Set the system timezone as \"UK\", set the range to `['2016-07-01', '2016-12-31']`\n    // Consider case2:\n    // Firstly set system timezone as \"Time Zone: America/Toronto\",\n    // ```\n    // var first = new Date(1478412000000 - 3600 * 1000 * 2.5);\n    // var second = new Date(1478412000000);\n    // var allDays = Math.floor(second / ONE_DAY) - Math.floor(first / ONE_DAY) + 1;\n    // ```\n    // will get wrong result because of DST. So we should fix it.\n\n    var date = new Date(range[0].time);\n    var startDateNum = date.getDate();\n    var endDateNum = range[1].date.getDate();\n    date.setDate(startDateNum + allDay - 1); // The bias can not over a month, so just compare date.\n\n    var dateNum = date.getDate();\n\n    if (dateNum !== endDateNum) {\n      var sign = date.getTime() - range[1].time > 0 ? 1 : -1;\n\n      while ((dateNum = date.getDate()) !== endDateNum && (date.getTime() - range[1].time) * sign > 0) {\n        allDay -= sign;\n        date.setDate(dateNum - sign);\n      }\n    }\n\n    var weeks = Math.floor((allDay + range[0].day + 6) / 7);\n    var nthWeek = reversed ? -weeks + 1 : weeks - 1;\n    reversed && range.reverse();\n    return {\n      range: [range[0].formatedDate, range[1].formatedDate],\n      start: range[0],\n      end: range[1],\n      allDay: allDay,\n      weeks: weeks,\n      // From 0.\n      nthWeek: nthWeek,\n      fweek: range[0].day,\n      lweek: range[1].day\n    };\n  },\n\n  /**\n   * get date by nthWeeks and week day in range\n   *\n   * @private\n   * @param  {number} nthWeek the week\n   * @param  {number} day   the week day\n   * @param  {Array} range [d1, d2]\n   * @return {Object}\n   */\n  _getDateByWeeksAndDay: function _getDateByWeeksAndDay(nthWeek, day, range) {\n    var rangeInfo = this._getRangeInfo(range);\n\n    if (nthWeek > rangeInfo.weeks || nthWeek === 0 && day < rangeInfo.fweek || nthWeek === rangeInfo.weeks && day > rangeInfo.lweek) {\n      return false;\n    }\n\n    var nthDay = (nthWeek - 1) * 7 - rangeInfo.fweek + day;\n    var date = new Date(rangeInfo.start.time);\n    date.setDate(rangeInfo.start.d + nthDay);\n    return this.getDateInfo(date);\n  }\n};\nCalendar.dimensions = Calendar.prototype.dimensions;\nCalendar.getDimensionsInfo = Calendar.prototype.getDimensionsInfo;\n\nCalendar.create = function (ecModel, api) {\n  var calendarList = [];\n  ecModel.eachComponent('calendar', function (calendarModel) {\n    var calendar = new Calendar(calendarModel, ecModel, api);\n    calendarList.push(calendar);\n    calendarModel.coordinateSystem = calendar;\n  });\n  ecModel.eachSeries(function (calendarSeries) {\n    if (calendarSeries.get('coordinateSystem') === 'calendar') {\n      // Inject coordinate system\n      calendarSeries.coordinateSystem = calendarList[calendarSeries.get('calendarIndex') || 0];\n    }\n  });\n  return calendarList;\n};\n\nfunction doConvert(methodName, ecModel, finder, value) {\n  var calendarModel = finder.calendarModel;\n  var seriesModel = finder.seriesModel;\n  var coordSys = calendarModel ? calendarModel.coordinateSystem : seriesModel ? seriesModel.coordinateSystem : null;\n  return coordSys === this ? coordSys[methodName](value) : null;\n}\n\nCoordinateSystem.register('calendar', Calendar);\nvar _default = Calendar;\nmodule.exports = _default;","map":{"version":3,"sources":["/home/johnatan/MP/mp-app/ap/node_modules/echarts/lib/coord/calendar/Calendar.js"],"names":["zrUtil","require","layout","numberUtil","CoordinateSystem","PROXIMATE_ONE_DAY","Calendar","calendarModel","ecModel","api","_model","prototype","constructor","type","dimensions","getDimensionsInfo","name","getRangeInfo","_rangeInfo","getModel","getRect","_rect","getCellWidth","_sw","getCellHeight","_sh","getOrient","_orient","getFirstDayOfWeek","_firstDayOfWeek","getDateInfo","date","parseDate","y","getFullYear","m","getMonth","d","getDate","day","getDay","Math","abs","time","getTime","formatedDate","getNextNDay","n","Date","setDate","update","get","_lineWidth","getItemStyle","lineWidth","_getRangeInfo","_initRangeOption","weeks","whNames","cellSize","slice","layoutParams","getBoxLayoutParams","cellNumbers","each","idx","cellSizeSpecified","whGlobal","width","getWidth","height","getHeight","calendarRect","getLayoutRect","dataToPoint","data","clamp","isArray","dayInfo","range","start","end","NaN","week","nthWeek","x","pointToData","point","pointToDate","dataToRect","contentShape","center","tl","tr","br","bl","nthX","floor","nthY","_getDateByWeeksAndDay","convertToPixel","curry","doConvert","convertFromPixel","rg","length","test","firstDay","setMonth","tmp","reverse","reversed","allDay","startDateNum","endDateNum","dateNum","sign","fweek","lweek","rangeInfo","nthDay","create","calendarList","eachComponent","calendar","push","coordinateSystem","eachSeries","calendarSeries","methodName","finder","value","seriesModel","coordSys","register","_default","module","exports"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n\nvar layout = require(\"../../util/layout\");\n\nvar numberUtil = require(\"../../util/number\");\n\nvar CoordinateSystem = require(\"../../CoordinateSystem\");\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// (24*60*60*1000)\nvar PROXIMATE_ONE_DAY = 86400000;\n/**\n * Calendar\n *\n * @constructor\n *\n * @param {Object} calendarModel calendarModel\n * @param {Object} ecModel       ecModel\n * @param {Object} api           api\n */\n\nfunction Calendar(calendarModel, ecModel, api) {\n  this._model = calendarModel;\n}\n\nCalendar.prototype = {\n  constructor: Calendar,\n  type: 'calendar',\n  dimensions: ['time', 'value'],\n  // Required in createListFromData\n  getDimensionsInfo: function () {\n    return [{\n      name: 'time',\n      type: 'time'\n    }, 'value'];\n  },\n  getRangeInfo: function () {\n    return this._rangeInfo;\n  },\n  getModel: function () {\n    return this._model;\n  },\n  getRect: function () {\n    return this._rect;\n  },\n  getCellWidth: function () {\n    return this._sw;\n  },\n  getCellHeight: function () {\n    return this._sh;\n  },\n  getOrient: function () {\n    return this._orient;\n  },\n\n  /**\n   * getFirstDayOfWeek\n   *\n   * @example\n   *     0 : start at Sunday\n   *     1 : start at Monday\n   *\n   * @return {number}\n   */\n  getFirstDayOfWeek: function () {\n    return this._firstDayOfWeek;\n  },\n\n  /**\n   * get date info\n   *\n   * @param  {string|number} date date\n   * @return {Object}\n   * {\n   *      y: string, local full year, eg., '1940',\n   *      m: string, local month, from '01' ot '12',\n   *      d: string, local date, from '01' to '31' (if exists),\n   *      day: It is not date.getDay(). It is the location of the cell in a week, from 0 to 6,\n   *      time: timestamp,\n   *      formatedDate: string, yyyy-MM-dd,\n   *      date: original date object.\n   * }\n   */\n  getDateInfo: function (date) {\n    date = numberUtil.parseDate(date);\n    var y = date.getFullYear();\n    var m = date.getMonth() + 1;\n    m = m < 10 ? '0' + m : m;\n    var d = date.getDate();\n    d = d < 10 ? '0' + d : d;\n    var day = date.getDay();\n    day = Math.abs((day + 7 - this.getFirstDayOfWeek()) % 7);\n    return {\n      y: y,\n      m: m,\n      d: d,\n      day: day,\n      time: date.getTime(),\n      formatedDate: y + '-' + m + '-' + d,\n      date: date\n    };\n  },\n  getNextNDay: function (date, n) {\n    n = n || 0;\n\n    if (n === 0) {\n      return this.getDateInfo(date);\n    }\n\n    date = new Date(this.getDateInfo(date).time);\n    date.setDate(date.getDate() + n);\n    return this.getDateInfo(date);\n  },\n  update: function (ecModel, api) {\n    this._firstDayOfWeek = +this._model.getModel('dayLabel').get('firstDay');\n    this._orient = this._model.get('orient');\n    this._lineWidth = this._model.getModel('itemStyle').getItemStyle().lineWidth || 0;\n    this._rangeInfo = this._getRangeInfo(this._initRangeOption());\n    var weeks = this._rangeInfo.weeks || 1;\n    var whNames = ['width', 'height'];\n\n    var cellSize = this._model.get('cellSize').slice();\n\n    var layoutParams = this._model.getBoxLayoutParams();\n\n    var cellNumbers = this._orient === 'horizontal' ? [weeks, 7] : [7, weeks];\n    zrUtil.each([0, 1], function (idx) {\n      if (cellSizeSpecified(cellSize, idx)) {\n        layoutParams[whNames[idx]] = cellSize[idx] * cellNumbers[idx];\n      }\n    });\n    var whGlobal = {\n      width: api.getWidth(),\n      height: api.getHeight()\n    };\n    var calendarRect = this._rect = layout.getLayoutRect(layoutParams, whGlobal);\n    zrUtil.each([0, 1], function (idx) {\n      if (!cellSizeSpecified(cellSize, idx)) {\n        cellSize[idx] = calendarRect[whNames[idx]] / cellNumbers[idx];\n      }\n    });\n\n    function cellSizeSpecified(cellSize, idx) {\n      return cellSize[idx] != null && cellSize[idx] !== 'auto';\n    }\n\n    this._sw = cellSize[0];\n    this._sh = cellSize[1];\n  },\n\n  /**\n   * Convert a time data(time, value) item to (x, y) point.\n   *\n   * @override\n   * @param  {Array|number} data data\n   * @param  {boolean} [clamp=true] out of range\n   * @return {Array} point\n   */\n  dataToPoint: function (data, clamp) {\n    zrUtil.isArray(data) && (data = data[0]);\n    clamp == null && (clamp = true);\n    var dayInfo = this.getDateInfo(data);\n    var range = this._rangeInfo;\n    var date = dayInfo.formatedDate; // if not in range return [NaN, NaN]\n\n    if (clamp && !(dayInfo.time >= range.start.time && dayInfo.time < range.end.time + PROXIMATE_ONE_DAY)) {\n      return [NaN, NaN];\n    }\n\n    var week = dayInfo.day;\n\n    var nthWeek = this._getRangeInfo([range.start.time, date]).nthWeek;\n\n    if (this._orient === 'vertical') {\n      return [this._rect.x + week * this._sw + this._sw / 2, this._rect.y + nthWeek * this._sh + this._sh / 2];\n    }\n\n    return [this._rect.x + nthWeek * this._sw + this._sw / 2, this._rect.y + week * this._sh + this._sh / 2];\n  },\n\n  /**\n   * Convert a (x, y) point to time data\n   *\n   * @override\n   * @param  {string} point point\n   * @return {string}       data\n   */\n  pointToData: function (point) {\n    var date = this.pointToDate(point);\n    return date && date.time;\n  },\n\n  /**\n   * Convert a time date item to (x, y) four point.\n   *\n   * @param  {Array} data  date[0] is date\n   * @param  {boolean} [clamp=true]  out of range\n   * @return {Object}       point\n   */\n  dataToRect: function (data, clamp) {\n    var point = this.dataToPoint(data, clamp);\n    return {\n      contentShape: {\n        x: point[0] - (this._sw - this._lineWidth) / 2,\n        y: point[1] - (this._sh - this._lineWidth) / 2,\n        width: this._sw - this._lineWidth,\n        height: this._sh - this._lineWidth\n      },\n      center: point,\n      tl: [point[0] - this._sw / 2, point[1] - this._sh / 2],\n      tr: [point[0] + this._sw / 2, point[1] - this._sh / 2],\n      br: [point[0] + this._sw / 2, point[1] + this._sh / 2],\n      bl: [point[0] - this._sw / 2, point[1] + this._sh / 2]\n    };\n  },\n\n  /**\n   * Convert a (x, y) point to time date\n   *\n   * @param  {Array} point point\n   * @return {Object}       date\n   */\n  pointToDate: function (point) {\n    var nthX = Math.floor((point[0] - this._rect.x) / this._sw) + 1;\n    var nthY = Math.floor((point[1] - this._rect.y) / this._sh) + 1;\n    var range = this._rangeInfo.range;\n\n    if (this._orient === 'vertical') {\n      return this._getDateByWeeksAndDay(nthY, nthX - 1, range);\n    }\n\n    return this._getDateByWeeksAndDay(nthX, nthY - 1, range);\n  },\n\n  /**\n   * @inheritDoc\n   */\n  convertToPixel: zrUtil.curry(doConvert, 'dataToPoint'),\n\n  /**\n   * @inheritDoc\n   */\n  convertFromPixel: zrUtil.curry(doConvert, 'pointToData'),\n\n  /**\n   * initRange\n   *\n   * @private\n   * @return {Array} [start, end]\n   */\n  _initRangeOption: function () {\n    var range = this._model.get('range');\n\n    var rg = range;\n\n    if (zrUtil.isArray(rg) && rg.length === 1) {\n      rg = rg[0];\n    }\n\n    if (/^\\d{4}$/.test(rg)) {\n      range = [rg + '-01-01', rg + '-12-31'];\n    }\n\n    if (/^\\d{4}[\\/|-]\\d{1,2}$/.test(rg)) {\n      var start = this.getDateInfo(rg);\n      var firstDay = start.date;\n      firstDay.setMonth(firstDay.getMonth() + 1);\n      var end = this.getNextNDay(firstDay, -1);\n      range = [start.formatedDate, end.formatedDate];\n    }\n\n    if (/^\\d{4}[\\/|-]\\d{1,2}[\\/|-]\\d{1,2}$/.test(rg)) {\n      range = [rg, rg];\n    }\n\n    var tmp = this._getRangeInfo(range);\n\n    if (tmp.start.time > tmp.end.time) {\n      range.reverse();\n    }\n\n    return range;\n  },\n\n  /**\n   * range info\n   *\n   * @private\n   * @param  {Array} range range ['2017-01-01', '2017-07-08']\n   *  If range[0] > range[1], they will not be reversed.\n   * @return {Object}       obj\n   */\n  _getRangeInfo: function (range) {\n    range = [this.getDateInfo(range[0]), this.getDateInfo(range[1])];\n    var reversed;\n\n    if (range[0].time > range[1].time) {\n      reversed = true;\n      range.reverse();\n    }\n\n    var allDay = Math.floor(range[1].time / PROXIMATE_ONE_DAY) - Math.floor(range[0].time / PROXIMATE_ONE_DAY) + 1; // Consider case1 (#11677 #10430):\n    // Set the system timezone as \"UK\", set the range to `['2016-07-01', '2016-12-31']`\n    // Consider case2:\n    // Firstly set system timezone as \"Time Zone: America/Toronto\",\n    // ```\n    // var first = new Date(1478412000000 - 3600 * 1000 * 2.5);\n    // var second = new Date(1478412000000);\n    // var allDays = Math.floor(second / ONE_DAY) - Math.floor(first / ONE_DAY) + 1;\n    // ```\n    // will get wrong result because of DST. So we should fix it.\n\n    var date = new Date(range[0].time);\n    var startDateNum = date.getDate();\n    var endDateNum = range[1].date.getDate();\n    date.setDate(startDateNum + allDay - 1); // The bias can not over a month, so just compare date.\n\n    var dateNum = date.getDate();\n\n    if (dateNum !== endDateNum) {\n      var sign = date.getTime() - range[1].time > 0 ? 1 : -1;\n\n      while ((dateNum = date.getDate()) !== endDateNum && (date.getTime() - range[1].time) * sign > 0) {\n        allDay -= sign;\n        date.setDate(dateNum - sign);\n      }\n    }\n\n    var weeks = Math.floor((allDay + range[0].day + 6) / 7);\n    var nthWeek = reversed ? -weeks + 1 : weeks - 1;\n    reversed && range.reverse();\n    return {\n      range: [range[0].formatedDate, range[1].formatedDate],\n      start: range[0],\n      end: range[1],\n      allDay: allDay,\n      weeks: weeks,\n      // From 0.\n      nthWeek: nthWeek,\n      fweek: range[0].day,\n      lweek: range[1].day\n    };\n  },\n\n  /**\n   * get date by nthWeeks and week day in range\n   *\n   * @private\n   * @param  {number} nthWeek the week\n   * @param  {number} day   the week day\n   * @param  {Array} range [d1, d2]\n   * @return {Object}\n   */\n  _getDateByWeeksAndDay: function (nthWeek, day, range) {\n    var rangeInfo = this._getRangeInfo(range);\n\n    if (nthWeek > rangeInfo.weeks || nthWeek === 0 && day < rangeInfo.fweek || nthWeek === rangeInfo.weeks && day > rangeInfo.lweek) {\n      return false;\n    }\n\n    var nthDay = (nthWeek - 1) * 7 - rangeInfo.fweek + day;\n    var date = new Date(rangeInfo.start.time);\n    date.setDate(rangeInfo.start.d + nthDay);\n    return this.getDateInfo(date);\n  }\n};\nCalendar.dimensions = Calendar.prototype.dimensions;\nCalendar.getDimensionsInfo = Calendar.prototype.getDimensionsInfo;\n\nCalendar.create = function (ecModel, api) {\n  var calendarList = [];\n  ecModel.eachComponent('calendar', function (calendarModel) {\n    var calendar = new Calendar(calendarModel, ecModel, api);\n    calendarList.push(calendar);\n    calendarModel.coordinateSystem = calendar;\n  });\n  ecModel.eachSeries(function (calendarSeries) {\n    if (calendarSeries.get('coordinateSystem') === 'calendar') {\n      // Inject coordinate system\n      calendarSeries.coordinateSystem = calendarList[calendarSeries.get('calendarIndex') || 0];\n    }\n  });\n  return calendarList;\n};\n\nfunction doConvert(methodName, ecModel, finder, value) {\n  var calendarModel = finder.calendarModel;\n  var seriesModel = finder.seriesModel;\n  var coordSys = calendarModel ? calendarModel.coordinateSystem : seriesModel ? seriesModel.coordinateSystem : null;\n  return coordSys === this ? coordSys[methodName](value) : null;\n}\n\nCoordinateSystem.register('calendar', Calendar);\nvar _default = Calendar;\nmodule.exports = _default;"]},"metadata":{},"sourceType":"script"}