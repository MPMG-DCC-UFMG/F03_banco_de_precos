{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar textContain = require(\"zrender/lib/contain/text\");\n\nvar _number = require(\"../../util/number\");\n\nvar parsePercent = _number.parsePercent;\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// FIXME emphasis label position is not same with normal label position\n\nvar RADIAN = Math.PI / 180;\n\nfunction adjustSingleSide(list, cx, cy, r, dir, viewWidth, viewHeight, viewLeft, viewTop, farthestX) {\n  list.sort(function (a, b) {\n    return a.y - b.y;\n  });\n\n  function shiftDown(start, end, delta, dir) {\n    for (var j = start; j < end; j++) {\n      if (list[j].y + delta > viewTop + viewHeight) {\n        break;\n      }\n\n      list[j].y += delta;\n\n      if (j > start && j + 1 < end && list[j + 1].y > list[j].y + list[j].height) {\n        shiftUp(j, delta / 2);\n        return;\n      }\n    }\n\n    shiftUp(end - 1, delta / 2);\n  }\n\n  function shiftUp(end, delta) {\n    for (var j = end; j >= 0; j--) {\n      if (list[j].y - delta < viewTop) {\n        break;\n      }\n\n      list[j].y -= delta;\n\n      if (j > 0 && list[j].y > list[j - 1].y + list[j - 1].height) {\n        break;\n      }\n    }\n  }\n\n  function changeX(list, isDownList, cx, cy, r, dir) {\n    var lastDeltaX = dir > 0 ? isDownList // right-side\n    ? Number.MAX_VALUE // down\n    : 0 // up\n    : isDownList // left-side\n    ? Number.MAX_VALUE // down\n    : 0; // up\n\n    for (var i = 0, l = list.length; i < l; i++) {\n      if (list[i].labelAlignTo !== 'none') {\n        continue;\n      }\n\n      var deltaY = Math.abs(list[i].y - cy);\n      var length = list[i].len;\n      var length2 = list[i].len2;\n      var deltaX = deltaY < r + length ? Math.sqrt((r + length + length2) * (r + length + length2) - deltaY * deltaY) : Math.abs(list[i].x - cx);\n\n      if (isDownList && deltaX >= lastDeltaX) {\n        // right-down, left-down\n        deltaX = lastDeltaX - 10;\n      }\n\n      if (!isDownList && deltaX <= lastDeltaX) {\n        // right-up, left-up\n        deltaX = lastDeltaX + 10;\n      }\n\n      list[i].x = cx + deltaX * dir;\n      lastDeltaX = deltaX;\n    }\n  }\n\n  var lastY = 0;\n  var delta;\n  var len = list.length;\n  var upList = [];\n  var downList = [];\n\n  for (var i = 0; i < len; i++) {\n    if (list[i].position === 'outer' && list[i].labelAlignTo === 'labelLine') {\n      var dx = list[i].x - farthestX;\n      list[i].linePoints[1][0] += dx;\n      list[i].x = farthestX;\n    }\n\n    delta = list[i].y - lastY;\n\n    if (delta < 0) {\n      shiftDown(i, len, -delta, dir);\n    }\n\n    lastY = list[i].y + list[i].height;\n  }\n\n  if (viewHeight - lastY < 0) {\n    shiftUp(len - 1, lastY - viewHeight);\n  }\n\n  for (var i = 0; i < len; i++) {\n    if (list[i].y >= cy) {\n      downList.push(list[i]);\n    } else {\n      upList.push(list[i]);\n    }\n  }\n\n  changeX(upList, false, cx, cy, r, dir);\n  changeX(downList, true, cx, cy, r, dir);\n}\n\nfunction avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight, viewLeft, viewTop) {\n  var leftList = [];\n  var rightList = [];\n  var leftmostX = Number.MAX_VALUE;\n  var rightmostX = -Number.MAX_VALUE;\n\n  for (var i = 0; i < labelLayoutList.length; i++) {\n    if (isPositionCenter(labelLayoutList[i])) {\n      continue;\n    }\n\n    if (labelLayoutList[i].x < cx) {\n      leftmostX = Math.min(leftmostX, labelLayoutList[i].x);\n      leftList.push(labelLayoutList[i]);\n    } else {\n      rightmostX = Math.max(rightmostX, labelLayoutList[i].x);\n      rightList.push(labelLayoutList[i]);\n    }\n  }\n\n  adjustSingleSide(rightList, cx, cy, r, 1, viewWidth, viewHeight, viewLeft, viewTop, rightmostX);\n  adjustSingleSide(leftList, cx, cy, r, -1, viewWidth, viewHeight, viewLeft, viewTop, leftmostX);\n\n  for (var i = 0; i < labelLayoutList.length; i++) {\n    var layout = labelLayoutList[i];\n\n    if (isPositionCenter(layout)) {\n      continue;\n    }\n\n    var linePoints = layout.linePoints;\n\n    if (linePoints) {\n      var isAlignToEdge = layout.labelAlignTo === 'edge';\n      var realTextWidth = layout.textRect.width;\n      var targetTextWidth;\n\n      if (isAlignToEdge) {\n        if (layout.x < cx) {\n          targetTextWidth = linePoints[2][0] - layout.labelDistance - viewLeft - layout.labelMargin;\n        } else {\n          targetTextWidth = viewLeft + viewWidth - layout.labelMargin - linePoints[2][0] - layout.labelDistance;\n        }\n      } else {\n        if (layout.x < cx) {\n          targetTextWidth = layout.x - viewLeft - layout.bleedMargin;\n        } else {\n          targetTextWidth = viewLeft + viewWidth - layout.x - layout.bleedMargin;\n        }\n      }\n\n      if (targetTextWidth < layout.textRect.width) {\n        layout.text = textContain.truncateText(layout.text, targetTextWidth, layout.font);\n\n        if (layout.labelAlignTo === 'edge') {\n          realTextWidth = textContain.getWidth(layout.text, layout.font);\n        }\n      }\n\n      var dist = linePoints[1][0] - linePoints[2][0];\n\n      if (isAlignToEdge) {\n        if (layout.x < cx) {\n          linePoints[2][0] = viewLeft + layout.labelMargin + realTextWidth + layout.labelDistance;\n        } else {\n          linePoints[2][0] = viewLeft + viewWidth - layout.labelMargin - realTextWidth - layout.labelDistance;\n        }\n      } else {\n        if (layout.x < cx) {\n          linePoints[2][0] = layout.x + layout.labelDistance;\n        } else {\n          linePoints[2][0] = layout.x - layout.labelDistance;\n        }\n\n        linePoints[1][0] = linePoints[2][0] + dist;\n      }\n\n      linePoints[1][1] = linePoints[2][1] = layout.y;\n    }\n  }\n}\n\nfunction isPositionCenter(layout) {\n  // Not change x for center label\n  return layout.position === 'center';\n}\n\nfunction _default(seriesModel, r, viewWidth, viewHeight, viewLeft, viewTop) {\n  var data = seriesModel.getData();\n  var labelLayoutList = [];\n  var cx;\n  var cy;\n  var hasLabelRotate = false;\n  var minShowLabelRadian = (seriesModel.get('minShowLabelAngle') || 0) * RADIAN;\n  data.each(function (idx) {\n    var layout = data.getItemLayout(idx);\n    var itemModel = data.getItemModel(idx);\n    var labelModel = itemModel.getModel('label'); // Use position in normal or emphasis\n\n    var labelPosition = labelModel.get('position') || itemModel.get('emphasis.label.position');\n    var labelDistance = labelModel.get('distanceToLabelLine');\n    var labelAlignTo = labelModel.get('alignTo');\n    var labelMargin = parsePercent(labelModel.get('margin'), viewWidth);\n    var bleedMargin = labelModel.get('bleedMargin');\n    var font = labelModel.getFont();\n    var labelLineModel = itemModel.getModel('labelLine');\n    var labelLineLen = labelLineModel.get('length');\n    labelLineLen = parsePercent(labelLineLen, viewWidth);\n    var labelLineLen2 = labelLineModel.get('length2');\n    labelLineLen2 = parsePercent(labelLineLen2, viewWidth);\n\n    if (layout.angle < minShowLabelRadian) {\n      return;\n    }\n\n    var midAngle = (layout.startAngle + layout.endAngle) / 2;\n    var dx = Math.cos(midAngle);\n    var dy = Math.sin(midAngle);\n    var textX;\n    var textY;\n    var linePoints;\n    var textAlign;\n    cx = layout.cx;\n    cy = layout.cy;\n    var text = seriesModel.getFormattedLabel(idx, 'normal') || data.getName(idx);\n    var textRect = textContain.getBoundingRect(text, font, textAlign, 'top');\n    var isLabelInside = labelPosition === 'inside' || labelPosition === 'inner';\n\n    if (labelPosition === 'center') {\n      textX = layout.cx;\n      textY = layout.cy;\n      textAlign = 'center';\n    } else {\n      var x1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dx : layout.r * dx) + cx;\n      var y1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dy : layout.r * dy) + cy;\n      textX = x1 + dx * 3;\n      textY = y1 + dy * 3;\n\n      if (!isLabelInside) {\n        // For roseType\n        var x2 = x1 + dx * (labelLineLen + r - layout.r);\n        var y2 = y1 + dy * (labelLineLen + r - layout.r);\n        var x3 = x2 + (dx < 0 ? -1 : 1) * labelLineLen2;\n        var y3 = y2;\n\n        if (labelAlignTo === 'edge') {\n          // Adjust textX because text align of edge is opposite\n          textX = dx < 0 ? viewLeft + labelMargin : viewLeft + viewWidth - labelMargin;\n        } else {\n          textX = x3 + (dx < 0 ? -labelDistance : labelDistance);\n        }\n\n        textY = y3;\n        linePoints = [[x1, y1], [x2, y2], [x3, y3]];\n      }\n\n      textAlign = isLabelInside ? 'center' : labelAlignTo === 'edge' ? dx > 0 ? 'right' : 'left' : dx > 0 ? 'left' : 'right';\n    }\n\n    var labelRotate;\n    var rotate = labelModel.get('rotate');\n\n    if (typeof rotate === 'number') {\n      labelRotate = rotate * (Math.PI / 180);\n    } else {\n      labelRotate = rotate ? dx < 0 ? -midAngle + Math.PI : -midAngle : 0;\n    }\n\n    hasLabelRotate = !!labelRotate;\n    layout.label = {\n      x: textX,\n      y: textY,\n      position: labelPosition,\n      height: textRect.height,\n      len: labelLineLen,\n      len2: labelLineLen2,\n      linePoints: linePoints,\n      textAlign: textAlign,\n      verticalAlign: 'middle',\n      rotation: labelRotate,\n      inside: isLabelInside,\n      labelDistance: labelDistance,\n      labelAlignTo: labelAlignTo,\n      labelMargin: labelMargin,\n      bleedMargin: bleedMargin,\n      textRect: textRect,\n      text: text,\n      font: font\n    }; // Not layout the inside label\n\n    if (!isLabelInside) {\n      labelLayoutList.push(layout.label);\n    }\n  });\n\n  if (!hasLabelRotate && seriesModel.get('avoidLabelOverlap')) {\n    avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight, viewLeft, viewTop);\n  }\n}\n\nmodule.exports = _default;","map":{"version":3,"sources":["/home/johnatan/MP/mp-app/ap/node_modules/echarts/lib/chart/pie/labelLayout.js"],"names":["textContain","require","_number","parsePercent","RADIAN","Math","PI","adjustSingleSide","list","cx","cy","r","dir","viewWidth","viewHeight","viewLeft","viewTop","farthestX","sort","a","b","y","shiftDown","start","end","delta","j","height","shiftUp","changeX","isDownList","lastDeltaX","Number","MAX_VALUE","i","l","length","labelAlignTo","deltaY","abs","len","length2","len2","deltaX","sqrt","x","lastY","upList","downList","position","dx","linePoints","push","avoidOverlap","labelLayoutList","leftList","rightList","leftmostX","rightmostX","isPositionCenter","min","max","layout","isAlignToEdge","realTextWidth","textRect","width","targetTextWidth","labelDistance","labelMargin","bleedMargin","text","truncateText","font","getWidth","dist","_default","seriesModel","data","getData","hasLabelRotate","minShowLabelRadian","get","each","idx","getItemLayout","itemModel","getItemModel","labelModel","getModel","labelPosition","getFont","labelLineModel","labelLineLen","labelLineLen2","angle","midAngle","startAngle","endAngle","cos","dy","sin","textX","textY","textAlign","getFormattedLabel","getName","getBoundingRect","isLabelInside","x1","r0","y1","x2","y2","x3","y3","labelRotate","rotate","label","verticalAlign","rotation","inside","module","exports"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\nvar textContain = require(\"zrender/lib/contain/text\");\n\nvar _number = require(\"../../util/number\");\n\nvar parsePercent = _number.parsePercent;\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// FIXME emphasis label position is not same with normal label position\nvar RADIAN = Math.PI / 180;\n\nfunction adjustSingleSide(list, cx, cy, r, dir, viewWidth, viewHeight, viewLeft, viewTop, farthestX) {\n  list.sort(function (a, b) {\n    return a.y - b.y;\n  });\n\n  function shiftDown(start, end, delta, dir) {\n    for (var j = start; j < end; j++) {\n      if (list[j].y + delta > viewTop + viewHeight) {\n        break;\n      }\n\n      list[j].y += delta;\n\n      if (j > start && j + 1 < end && list[j + 1].y > list[j].y + list[j].height) {\n        shiftUp(j, delta / 2);\n        return;\n      }\n    }\n\n    shiftUp(end - 1, delta / 2);\n  }\n\n  function shiftUp(end, delta) {\n    for (var j = end; j >= 0; j--) {\n      if (list[j].y - delta < viewTop) {\n        break;\n      }\n\n      list[j].y -= delta;\n\n      if (j > 0 && list[j].y > list[j - 1].y + list[j - 1].height) {\n        break;\n      }\n    }\n  }\n\n  function changeX(list, isDownList, cx, cy, r, dir) {\n    var lastDeltaX = dir > 0 ? isDownList // right-side\n    ? Number.MAX_VALUE // down\n    : 0 // up\n    : isDownList // left-side\n    ? Number.MAX_VALUE // down\n    : 0; // up\n\n    for (var i = 0, l = list.length; i < l; i++) {\n      if (list[i].labelAlignTo !== 'none') {\n        continue;\n      }\n\n      var deltaY = Math.abs(list[i].y - cy);\n      var length = list[i].len;\n      var length2 = list[i].len2;\n      var deltaX = deltaY < r + length ? Math.sqrt((r + length + length2) * (r + length + length2) - deltaY * deltaY) : Math.abs(list[i].x - cx);\n\n      if (isDownList && deltaX >= lastDeltaX) {\n        // right-down, left-down\n        deltaX = lastDeltaX - 10;\n      }\n\n      if (!isDownList && deltaX <= lastDeltaX) {\n        // right-up, left-up\n        deltaX = lastDeltaX + 10;\n      }\n\n      list[i].x = cx + deltaX * dir;\n      lastDeltaX = deltaX;\n    }\n  }\n\n  var lastY = 0;\n  var delta;\n  var len = list.length;\n  var upList = [];\n  var downList = [];\n\n  for (var i = 0; i < len; i++) {\n    if (list[i].position === 'outer' && list[i].labelAlignTo === 'labelLine') {\n      var dx = list[i].x - farthestX;\n      list[i].linePoints[1][0] += dx;\n      list[i].x = farthestX;\n    }\n\n    delta = list[i].y - lastY;\n\n    if (delta < 0) {\n      shiftDown(i, len, -delta, dir);\n    }\n\n    lastY = list[i].y + list[i].height;\n  }\n\n  if (viewHeight - lastY < 0) {\n    shiftUp(len - 1, lastY - viewHeight);\n  }\n\n  for (var i = 0; i < len; i++) {\n    if (list[i].y >= cy) {\n      downList.push(list[i]);\n    } else {\n      upList.push(list[i]);\n    }\n  }\n\n  changeX(upList, false, cx, cy, r, dir);\n  changeX(downList, true, cx, cy, r, dir);\n}\n\nfunction avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight, viewLeft, viewTop) {\n  var leftList = [];\n  var rightList = [];\n  var leftmostX = Number.MAX_VALUE;\n  var rightmostX = -Number.MAX_VALUE;\n\n  for (var i = 0; i < labelLayoutList.length; i++) {\n    if (isPositionCenter(labelLayoutList[i])) {\n      continue;\n    }\n\n    if (labelLayoutList[i].x < cx) {\n      leftmostX = Math.min(leftmostX, labelLayoutList[i].x);\n      leftList.push(labelLayoutList[i]);\n    } else {\n      rightmostX = Math.max(rightmostX, labelLayoutList[i].x);\n      rightList.push(labelLayoutList[i]);\n    }\n  }\n\n  adjustSingleSide(rightList, cx, cy, r, 1, viewWidth, viewHeight, viewLeft, viewTop, rightmostX);\n  adjustSingleSide(leftList, cx, cy, r, -1, viewWidth, viewHeight, viewLeft, viewTop, leftmostX);\n\n  for (var i = 0; i < labelLayoutList.length; i++) {\n    var layout = labelLayoutList[i];\n\n    if (isPositionCenter(layout)) {\n      continue;\n    }\n\n    var linePoints = layout.linePoints;\n\n    if (linePoints) {\n      var isAlignToEdge = layout.labelAlignTo === 'edge';\n      var realTextWidth = layout.textRect.width;\n      var targetTextWidth;\n\n      if (isAlignToEdge) {\n        if (layout.x < cx) {\n          targetTextWidth = linePoints[2][0] - layout.labelDistance - viewLeft - layout.labelMargin;\n        } else {\n          targetTextWidth = viewLeft + viewWidth - layout.labelMargin - linePoints[2][0] - layout.labelDistance;\n        }\n      } else {\n        if (layout.x < cx) {\n          targetTextWidth = layout.x - viewLeft - layout.bleedMargin;\n        } else {\n          targetTextWidth = viewLeft + viewWidth - layout.x - layout.bleedMargin;\n        }\n      }\n\n      if (targetTextWidth < layout.textRect.width) {\n        layout.text = textContain.truncateText(layout.text, targetTextWidth, layout.font);\n\n        if (layout.labelAlignTo === 'edge') {\n          realTextWidth = textContain.getWidth(layout.text, layout.font);\n        }\n      }\n\n      var dist = linePoints[1][0] - linePoints[2][0];\n\n      if (isAlignToEdge) {\n        if (layout.x < cx) {\n          linePoints[2][0] = viewLeft + layout.labelMargin + realTextWidth + layout.labelDistance;\n        } else {\n          linePoints[2][0] = viewLeft + viewWidth - layout.labelMargin - realTextWidth - layout.labelDistance;\n        }\n      } else {\n        if (layout.x < cx) {\n          linePoints[2][0] = layout.x + layout.labelDistance;\n        } else {\n          linePoints[2][0] = layout.x - layout.labelDistance;\n        }\n\n        linePoints[1][0] = linePoints[2][0] + dist;\n      }\n\n      linePoints[1][1] = linePoints[2][1] = layout.y;\n    }\n  }\n}\n\nfunction isPositionCenter(layout) {\n  // Not change x for center label\n  return layout.position === 'center';\n}\n\nfunction _default(seriesModel, r, viewWidth, viewHeight, viewLeft, viewTop) {\n  var data = seriesModel.getData();\n  var labelLayoutList = [];\n  var cx;\n  var cy;\n  var hasLabelRotate = false;\n  var minShowLabelRadian = (seriesModel.get('minShowLabelAngle') || 0) * RADIAN;\n  data.each(function (idx) {\n    var layout = data.getItemLayout(idx);\n    var itemModel = data.getItemModel(idx);\n    var labelModel = itemModel.getModel('label'); // Use position in normal or emphasis\n\n    var labelPosition = labelModel.get('position') || itemModel.get('emphasis.label.position');\n    var labelDistance = labelModel.get('distanceToLabelLine');\n    var labelAlignTo = labelModel.get('alignTo');\n    var labelMargin = parsePercent(labelModel.get('margin'), viewWidth);\n    var bleedMargin = labelModel.get('bleedMargin');\n    var font = labelModel.getFont();\n    var labelLineModel = itemModel.getModel('labelLine');\n    var labelLineLen = labelLineModel.get('length');\n    labelLineLen = parsePercent(labelLineLen, viewWidth);\n    var labelLineLen2 = labelLineModel.get('length2');\n    labelLineLen2 = parsePercent(labelLineLen2, viewWidth);\n\n    if (layout.angle < minShowLabelRadian) {\n      return;\n    }\n\n    var midAngle = (layout.startAngle + layout.endAngle) / 2;\n    var dx = Math.cos(midAngle);\n    var dy = Math.sin(midAngle);\n    var textX;\n    var textY;\n    var linePoints;\n    var textAlign;\n    cx = layout.cx;\n    cy = layout.cy;\n    var text = seriesModel.getFormattedLabel(idx, 'normal') || data.getName(idx);\n    var textRect = textContain.getBoundingRect(text, font, textAlign, 'top');\n    var isLabelInside = labelPosition === 'inside' || labelPosition === 'inner';\n\n    if (labelPosition === 'center') {\n      textX = layout.cx;\n      textY = layout.cy;\n      textAlign = 'center';\n    } else {\n      var x1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dx : layout.r * dx) + cx;\n      var y1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dy : layout.r * dy) + cy;\n      textX = x1 + dx * 3;\n      textY = y1 + dy * 3;\n\n      if (!isLabelInside) {\n        // For roseType\n        var x2 = x1 + dx * (labelLineLen + r - layout.r);\n        var y2 = y1 + dy * (labelLineLen + r - layout.r);\n        var x3 = x2 + (dx < 0 ? -1 : 1) * labelLineLen2;\n        var y3 = y2;\n\n        if (labelAlignTo === 'edge') {\n          // Adjust textX because text align of edge is opposite\n          textX = dx < 0 ? viewLeft + labelMargin : viewLeft + viewWidth - labelMargin;\n        } else {\n          textX = x3 + (dx < 0 ? -labelDistance : labelDistance);\n        }\n\n        textY = y3;\n        linePoints = [[x1, y1], [x2, y2], [x3, y3]];\n      }\n\n      textAlign = isLabelInside ? 'center' : labelAlignTo === 'edge' ? dx > 0 ? 'right' : 'left' : dx > 0 ? 'left' : 'right';\n    }\n\n    var labelRotate;\n    var rotate = labelModel.get('rotate');\n\n    if (typeof rotate === 'number') {\n      labelRotate = rotate * (Math.PI / 180);\n    } else {\n      labelRotate = rotate ? dx < 0 ? -midAngle + Math.PI : -midAngle : 0;\n    }\n\n    hasLabelRotate = !!labelRotate;\n    layout.label = {\n      x: textX,\n      y: textY,\n      position: labelPosition,\n      height: textRect.height,\n      len: labelLineLen,\n      len2: labelLineLen2,\n      linePoints: linePoints,\n      textAlign: textAlign,\n      verticalAlign: 'middle',\n      rotation: labelRotate,\n      inside: isLabelInside,\n      labelDistance: labelDistance,\n      labelAlignTo: labelAlignTo,\n      labelMargin: labelMargin,\n      bleedMargin: bleedMargin,\n      textRect: textRect,\n      text: text,\n      font: font\n    }; // Not layout the inside label\n\n    if (!isLabelInside) {\n      labelLayoutList.push(layout.label);\n    }\n  });\n\n  if (!hasLabelRotate && seriesModel.get('avoidLabelOverlap')) {\n    avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight, viewLeft, viewTop);\n  }\n}\n\nmodule.exports = _default;"]},"metadata":{},"sourceType":"script"}