{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar graphic = require(\"../../util/graphic\");\n\nvar echarts = require(\"../../echarts\");\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\nvar nodeOpacityPath = ['itemStyle', 'opacity'];\nvar hoverNodeOpacityPath = ['emphasis', 'itemStyle', 'opacity'];\nvar lineOpacityPath = ['lineStyle', 'opacity'];\nvar hoverLineOpacityPath = ['emphasis', 'lineStyle', 'opacity'];\n\nfunction getItemOpacity(item, opacityPath) {\n  return item.getVisual('opacity') || item.getModel().get(opacityPath);\n}\n\nfunction fadeOutItem(item, opacityPath, opacityRatio) {\n  var el = item.getGraphicEl();\n  var opacity = getItemOpacity(item, opacityPath);\n\n  if (opacityRatio != null) {\n    opacity == null && (opacity = 1);\n    opacity *= opacityRatio;\n  }\n\n  el.downplay && el.downplay();\n  el.traverse(function (child) {\n    if (child.type !== 'group') {\n      child.setStyle('opacity', opacity);\n    }\n  });\n}\n\nfunction fadeInItem(item, opacityPath) {\n  var opacity = getItemOpacity(item, opacityPath);\n  var el = item.getGraphicEl();\n  el.traverse(function (child) {\n    if (child.type !== 'group') {\n      child.setStyle('opacity', opacity);\n    }\n  }); // Support emphasis here.\n\n  el.highlight && el.highlight();\n}\n\nvar SankeyShape = graphic.extendShape({\n  shape: {\n    x1: 0,\n    y1: 0,\n    x2: 0,\n    y2: 0,\n    cpx1: 0,\n    cpy1: 0,\n    cpx2: 0,\n    cpy2: 0,\n    extent: 0,\n    orient: ''\n  },\n  buildPath: function buildPath(ctx, shape) {\n    var extent = shape.extent;\n    ctx.moveTo(shape.x1, shape.y1);\n    ctx.bezierCurveTo(shape.cpx1, shape.cpy1, shape.cpx2, shape.cpy2, shape.x2, shape.y2);\n\n    if (shape.orient === 'vertical') {\n      ctx.lineTo(shape.x2 + extent, shape.y2);\n      ctx.bezierCurveTo(shape.cpx2 + extent, shape.cpy2, shape.cpx1 + extent, shape.cpy1, shape.x1 + extent, shape.y1);\n    } else {\n      ctx.lineTo(shape.x2, shape.y2 + extent);\n      ctx.bezierCurveTo(shape.cpx2, shape.cpy2 + extent, shape.cpx1, shape.cpy1 + extent, shape.x1, shape.y1 + extent);\n    }\n\n    ctx.closePath();\n  },\n  highlight: function highlight() {\n    this.trigger('emphasis');\n  },\n  downplay: function downplay() {\n    this.trigger('normal');\n  }\n});\n\nvar _default = echarts.extendChartView({\n  type: 'sankey',\n\n  /**\n   * @private\n   * @type {module:echarts/chart/sankey/SankeySeries}\n   */\n  _model: null,\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  _focusAdjacencyDisabled: false,\n  render: function render(seriesModel, ecModel, api) {\n    var sankeyView = this;\n    var graph = seriesModel.getGraph();\n    var group = this.group;\n    var layoutInfo = seriesModel.layoutInfo; // view width\n\n    var width = layoutInfo.width; // view height\n\n    var height = layoutInfo.height;\n    var nodeData = seriesModel.getData();\n    var edgeData = seriesModel.getData('edge');\n    var orient = seriesModel.get('orient');\n    this._model = seriesModel;\n    group.removeAll();\n    group.attr('position', [layoutInfo.x, layoutInfo.y]); // generate a bezire Curve for each edge\n\n    graph.eachEdge(function (edge) {\n      var curve = new SankeyShape();\n      curve.dataIndex = edge.dataIndex;\n      curve.seriesIndex = seriesModel.seriesIndex;\n      curve.dataType = 'edge';\n      var lineStyleModel = edge.getModel('lineStyle');\n      var curvature = lineStyleModel.get('curveness');\n      var n1Layout = edge.node1.getLayout();\n      var node1Model = edge.node1.getModel();\n      var dragX1 = node1Model.get('localX');\n      var dragY1 = node1Model.get('localY');\n      var n2Layout = edge.node2.getLayout();\n      var node2Model = edge.node2.getModel();\n      var dragX2 = node2Model.get('localX');\n      var dragY2 = node2Model.get('localY');\n      var edgeLayout = edge.getLayout();\n      var x1;\n      var y1;\n      var x2;\n      var y2;\n      var cpx1;\n      var cpy1;\n      var cpx2;\n      var cpy2;\n      curve.shape.extent = Math.max(1, edgeLayout.dy);\n      curve.shape.orient = orient;\n\n      if (orient === 'vertical') {\n        x1 = (dragX1 != null ? dragX1 * width : n1Layout.x) + edgeLayout.sy;\n        y1 = (dragY1 != null ? dragY1 * height : n1Layout.y) + n1Layout.dy;\n        x2 = (dragX2 != null ? dragX2 * width : n2Layout.x) + edgeLayout.ty;\n        y2 = dragY2 != null ? dragY2 * height : n2Layout.y;\n        cpx1 = x1;\n        cpy1 = y1 * (1 - curvature) + y2 * curvature;\n        cpx2 = x2;\n        cpy2 = y1 * curvature + y2 * (1 - curvature);\n      } else {\n        x1 = (dragX1 != null ? dragX1 * width : n1Layout.x) + n1Layout.dx;\n        y1 = (dragY1 != null ? dragY1 * height : n1Layout.y) + edgeLayout.sy;\n        x2 = dragX2 != null ? dragX2 * width : n2Layout.x;\n        y2 = (dragY2 != null ? dragY2 * height : n2Layout.y) + edgeLayout.ty;\n        cpx1 = x1 * (1 - curvature) + x2 * curvature;\n        cpy1 = y1;\n        cpx2 = x1 * curvature + x2 * (1 - curvature);\n        cpy2 = y2;\n      }\n\n      curve.setShape({\n        x1: x1,\n        y1: y1,\n        x2: x2,\n        y2: y2,\n        cpx1: cpx1,\n        cpy1: cpy1,\n        cpx2: cpx2,\n        cpy2: cpy2\n      });\n      curve.setStyle(lineStyleModel.getItemStyle()); // Special color, use source node color or target node color\n\n      switch (curve.style.fill) {\n        case 'source':\n          curve.style.fill = edge.node1.getVisual('color');\n          break;\n\n        case 'target':\n          curve.style.fill = edge.node2.getVisual('color');\n          break;\n      }\n\n      graphic.setHoverStyle(curve, edge.getModel('emphasis.lineStyle').getItemStyle());\n      group.add(curve);\n      edgeData.setItemGraphicEl(edge.dataIndex, curve);\n    }); // Generate a rect for each node\n\n    graph.eachNode(function (node) {\n      var layout = node.getLayout();\n      var itemModel = node.getModel();\n      var dragX = itemModel.get('localX');\n      var dragY = itemModel.get('localY');\n      var labelModel = itemModel.getModel('label');\n      var labelHoverModel = itemModel.getModel('emphasis.label');\n      var rect = new graphic.Rect({\n        shape: {\n          x: dragX != null ? dragX * width : layout.x,\n          y: dragY != null ? dragY * height : layout.y,\n          width: layout.dx,\n          height: layout.dy\n        },\n        style: itemModel.getModel('itemStyle').getItemStyle()\n      });\n      var hoverStyle = node.getModel('emphasis.itemStyle').getItemStyle();\n      graphic.setLabelStyle(rect.style, hoverStyle, labelModel, labelHoverModel, {\n        labelFetcher: seriesModel,\n        labelDataIndex: node.dataIndex,\n        defaultText: node.id,\n        isRectText: true\n      });\n      rect.setStyle('fill', node.getVisual('color'));\n      graphic.setHoverStyle(rect, hoverStyle);\n      group.add(rect);\n      nodeData.setItemGraphicEl(node.dataIndex, rect);\n      rect.dataType = 'node';\n    });\n    nodeData.eachItemGraphicEl(function (el, dataIndex) {\n      var itemModel = nodeData.getItemModel(dataIndex);\n\n      if (itemModel.get('draggable')) {\n        el.drift = function (dx, dy) {\n          sankeyView._focusAdjacencyDisabled = true;\n          this.shape.x += dx;\n          this.shape.y += dy;\n          this.dirty();\n          api.dispatchAction({\n            type: 'dragNode',\n            seriesId: seriesModel.id,\n            dataIndex: nodeData.getRawIndex(dataIndex),\n            localX: this.shape.x / width,\n            localY: this.shape.y / height\n          });\n        };\n\n        el.ondragend = function () {\n          sankeyView._focusAdjacencyDisabled = false;\n        };\n\n        el.draggable = true;\n        el.cursor = 'move';\n      }\n\n      el.highlight = function () {\n        this.trigger('emphasis');\n      };\n\n      el.downplay = function () {\n        this.trigger('normal');\n      };\n\n      el.focusNodeAdjHandler && el.off('mouseover', el.focusNodeAdjHandler);\n      el.unfocusNodeAdjHandler && el.off('mouseout', el.unfocusNodeAdjHandler);\n\n      if (itemModel.get('focusNodeAdjacency')) {\n        el.on('mouseover', el.focusNodeAdjHandler = function () {\n          if (!sankeyView._focusAdjacencyDisabled) {\n            sankeyView._clearTimer();\n\n            api.dispatchAction({\n              type: 'focusNodeAdjacency',\n              seriesId: seriesModel.id,\n              dataIndex: el.dataIndex\n            });\n          }\n        });\n        el.on('mouseout', el.unfocusNodeAdjHandler = function () {\n          if (!sankeyView._focusAdjacencyDisabled) {\n            sankeyView._dispatchUnfocus(api);\n          }\n        });\n      }\n    });\n    edgeData.eachItemGraphicEl(function (el, dataIndex) {\n      var edgeModel = edgeData.getItemModel(dataIndex);\n      el.focusNodeAdjHandler && el.off('mouseover', el.focusNodeAdjHandler);\n      el.unfocusNodeAdjHandler && el.off('mouseout', el.unfocusNodeAdjHandler);\n\n      if (edgeModel.get('focusNodeAdjacency')) {\n        el.on('mouseover', el.focusNodeAdjHandler = function () {\n          if (!sankeyView._focusAdjacencyDisabled) {\n            sankeyView._clearTimer();\n\n            api.dispatchAction({\n              type: 'focusNodeAdjacency',\n              seriesId: seriesModel.id,\n              edgeDataIndex: el.dataIndex\n            });\n          }\n        });\n        el.on('mouseout', el.unfocusNodeAdjHandler = function () {\n          if (!sankeyView._focusAdjacencyDisabled) {\n            sankeyView._dispatchUnfocus(api);\n          }\n        });\n      }\n    });\n\n    if (!this._data && seriesModel.get('animation')) {\n      group.setClipPath(createGridClipShape(group.getBoundingRect(), seriesModel, function () {\n        group.removeClipPath();\n      }));\n    }\n\n    this._data = seriesModel.getData();\n  },\n  dispose: function dispose() {\n    this._clearTimer();\n  },\n  _dispatchUnfocus: function _dispatchUnfocus(api) {\n    var self = this;\n\n    this._clearTimer();\n\n    this._unfocusDelayTimer = setTimeout(function () {\n      self._unfocusDelayTimer = null;\n      api.dispatchAction({\n        type: 'unfocusNodeAdjacency',\n        seriesId: self._model.id\n      });\n    }, 500);\n  },\n  _clearTimer: function _clearTimer() {\n    if (this._unfocusDelayTimer) {\n      clearTimeout(this._unfocusDelayTimer);\n      this._unfocusDelayTimer = null;\n    }\n  },\n  focusNodeAdjacency: function focusNodeAdjacency(seriesModel, ecModel, api, payload) {\n    var data = seriesModel.getData();\n    var graph = data.graph;\n    var dataIndex = payload.dataIndex;\n    var itemModel = data.getItemModel(dataIndex);\n    var edgeDataIndex = payload.edgeDataIndex;\n\n    if (dataIndex == null && edgeDataIndex == null) {\n      return;\n    }\n\n    var node = graph.getNodeByIndex(dataIndex);\n    var edge = graph.getEdgeByIndex(edgeDataIndex);\n    graph.eachNode(function (node) {\n      fadeOutItem(node, nodeOpacityPath, 0.1);\n    });\n    graph.eachEdge(function (edge) {\n      fadeOutItem(edge, lineOpacityPath, 0.1);\n    });\n\n    if (node) {\n      fadeInItem(node, hoverNodeOpacityPath);\n      var focusNodeAdj = itemModel.get('focusNodeAdjacency');\n\n      if (focusNodeAdj === 'outEdges') {\n        zrUtil.each(node.outEdges, function (edge) {\n          if (edge.dataIndex < 0) {\n            return;\n          }\n\n          fadeInItem(edge, hoverLineOpacityPath);\n          fadeInItem(edge.node2, hoverNodeOpacityPath);\n        });\n      } else if (focusNodeAdj === 'inEdges') {\n        zrUtil.each(node.inEdges, function (edge) {\n          if (edge.dataIndex < 0) {\n            return;\n          }\n\n          fadeInItem(edge, hoverLineOpacityPath);\n          fadeInItem(edge.node1, hoverNodeOpacityPath);\n        });\n      } else if (focusNodeAdj === 'allEdges') {\n        zrUtil.each(node.edges, function (edge) {\n          if (edge.dataIndex < 0) {\n            return;\n          }\n\n          fadeInItem(edge, hoverLineOpacityPath);\n          edge.node1 !== node && fadeInItem(edge.node1, hoverNodeOpacityPath);\n          edge.node2 !== node && fadeInItem(edge.node2, hoverNodeOpacityPath);\n        });\n      }\n    }\n\n    if (edge) {\n      fadeInItem(edge, hoverLineOpacityPath);\n      fadeInItem(edge.node1, hoverNodeOpacityPath);\n      fadeInItem(edge.node2, hoverNodeOpacityPath);\n    }\n  },\n  unfocusNodeAdjacency: function unfocusNodeAdjacency(seriesModel, ecModel, api, payload) {\n    var graph = seriesModel.getGraph();\n    graph.eachNode(function (node) {\n      fadeOutItem(node, nodeOpacityPath);\n    });\n    graph.eachEdge(function (edge) {\n      fadeOutItem(edge, lineOpacityPath);\n    });\n  }\n}); // Add animation to the view\n\n\nfunction createGridClipShape(rect, seriesModel, cb) {\n  var rectEl = new graphic.Rect({\n    shape: {\n      x: rect.x - 10,\n      y: rect.y - 10,\n      width: 0,\n      height: rect.height + 20\n    }\n  });\n  graphic.initProps(rectEl, {\n    shape: {\n      width: rect.width + 20\n    }\n  }, seriesModel, cb);\n  return rectEl;\n}\n\nmodule.exports = _default;","map":{"version":3,"sources":["/home/johnatan/MP/mp-app/ap/node_modules/echarts/lib/chart/sankey/SankeyView.js"],"names":["graphic","require","echarts","zrUtil","nodeOpacityPath","hoverNodeOpacityPath","lineOpacityPath","hoverLineOpacityPath","getItemOpacity","item","opacityPath","getVisual","getModel","get","fadeOutItem","opacityRatio","el","getGraphicEl","opacity","downplay","traverse","child","type","setStyle","fadeInItem","highlight","SankeyShape","extendShape","shape","x1","y1","x2","y2","cpx1","cpy1","cpx2","cpy2","extent","orient","buildPath","ctx","moveTo","bezierCurveTo","lineTo","closePath","trigger","_default","extendChartView","_model","_focusAdjacencyDisabled","render","seriesModel","ecModel","api","sankeyView","graph","getGraph","group","layoutInfo","width","height","nodeData","getData","edgeData","removeAll","attr","x","y","eachEdge","edge","curve","dataIndex","seriesIndex","dataType","lineStyleModel","curvature","n1Layout","node1","getLayout","node1Model","dragX1","dragY1","n2Layout","node2","node2Model","dragX2","dragY2","edgeLayout","Math","max","dy","sy","ty","dx","setShape","getItemStyle","style","fill","setHoverStyle","add","setItemGraphicEl","eachNode","node","layout","itemModel","dragX","dragY","labelModel","labelHoverModel","rect","Rect","hoverStyle","setLabelStyle","labelFetcher","labelDataIndex","defaultText","id","isRectText","eachItemGraphicEl","getItemModel","drift","dirty","dispatchAction","seriesId","getRawIndex","localX","localY","ondragend","draggable","cursor","focusNodeAdjHandler","off","unfocusNodeAdjHandler","on","_clearTimer","_dispatchUnfocus","edgeModel","edgeDataIndex","_data","setClipPath","createGridClipShape","getBoundingRect","removeClipPath","dispose","self","_unfocusDelayTimer","setTimeout","clearTimeout","focusNodeAdjacency","payload","data","getNodeByIndex","getEdgeByIndex","focusNodeAdj","each","outEdges","inEdges","edges","unfocusNodeAdjacency","cb","rectEl","initProps","module","exports"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\nvar graphic = require(\"../../util/graphic\");\n\nvar echarts = require(\"../../echarts\");\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar nodeOpacityPath = ['itemStyle', 'opacity'];\nvar hoverNodeOpacityPath = ['emphasis', 'itemStyle', 'opacity'];\nvar lineOpacityPath = ['lineStyle', 'opacity'];\nvar hoverLineOpacityPath = ['emphasis', 'lineStyle', 'opacity'];\n\nfunction getItemOpacity(item, opacityPath) {\n  return item.getVisual('opacity') || item.getModel().get(opacityPath);\n}\n\nfunction fadeOutItem(item, opacityPath, opacityRatio) {\n  var el = item.getGraphicEl();\n  var opacity = getItemOpacity(item, opacityPath);\n\n  if (opacityRatio != null) {\n    opacity == null && (opacity = 1);\n    opacity *= opacityRatio;\n  }\n\n  el.downplay && el.downplay();\n  el.traverse(function (child) {\n    if (child.type !== 'group') {\n      child.setStyle('opacity', opacity);\n    }\n  });\n}\n\nfunction fadeInItem(item, opacityPath) {\n  var opacity = getItemOpacity(item, opacityPath);\n  var el = item.getGraphicEl();\n  el.traverse(function (child) {\n    if (child.type !== 'group') {\n      child.setStyle('opacity', opacity);\n    }\n  }); // Support emphasis here.\n\n  el.highlight && el.highlight();\n}\n\nvar SankeyShape = graphic.extendShape({\n  shape: {\n    x1: 0,\n    y1: 0,\n    x2: 0,\n    y2: 0,\n    cpx1: 0,\n    cpy1: 0,\n    cpx2: 0,\n    cpy2: 0,\n    extent: 0,\n    orient: ''\n  },\n  buildPath: function (ctx, shape) {\n    var extent = shape.extent;\n    ctx.moveTo(shape.x1, shape.y1);\n    ctx.bezierCurveTo(shape.cpx1, shape.cpy1, shape.cpx2, shape.cpy2, shape.x2, shape.y2);\n\n    if (shape.orient === 'vertical') {\n      ctx.lineTo(shape.x2 + extent, shape.y2);\n      ctx.bezierCurveTo(shape.cpx2 + extent, shape.cpy2, shape.cpx1 + extent, shape.cpy1, shape.x1 + extent, shape.y1);\n    } else {\n      ctx.lineTo(shape.x2, shape.y2 + extent);\n      ctx.bezierCurveTo(shape.cpx2, shape.cpy2 + extent, shape.cpx1, shape.cpy1 + extent, shape.x1, shape.y1 + extent);\n    }\n\n    ctx.closePath();\n  },\n  highlight: function () {\n    this.trigger('emphasis');\n  },\n  downplay: function () {\n    this.trigger('normal');\n  }\n});\n\nvar _default = echarts.extendChartView({\n  type: 'sankey',\n\n  /**\n   * @private\n   * @type {module:echarts/chart/sankey/SankeySeries}\n   */\n  _model: null,\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  _focusAdjacencyDisabled: false,\n  render: function (seriesModel, ecModel, api) {\n    var sankeyView = this;\n    var graph = seriesModel.getGraph();\n    var group = this.group;\n    var layoutInfo = seriesModel.layoutInfo; // view width\n\n    var width = layoutInfo.width; // view height\n\n    var height = layoutInfo.height;\n    var nodeData = seriesModel.getData();\n    var edgeData = seriesModel.getData('edge');\n    var orient = seriesModel.get('orient');\n    this._model = seriesModel;\n    group.removeAll();\n    group.attr('position', [layoutInfo.x, layoutInfo.y]); // generate a bezire Curve for each edge\n\n    graph.eachEdge(function (edge) {\n      var curve = new SankeyShape();\n      curve.dataIndex = edge.dataIndex;\n      curve.seriesIndex = seriesModel.seriesIndex;\n      curve.dataType = 'edge';\n      var lineStyleModel = edge.getModel('lineStyle');\n      var curvature = lineStyleModel.get('curveness');\n      var n1Layout = edge.node1.getLayout();\n      var node1Model = edge.node1.getModel();\n      var dragX1 = node1Model.get('localX');\n      var dragY1 = node1Model.get('localY');\n      var n2Layout = edge.node2.getLayout();\n      var node2Model = edge.node2.getModel();\n      var dragX2 = node2Model.get('localX');\n      var dragY2 = node2Model.get('localY');\n      var edgeLayout = edge.getLayout();\n      var x1;\n      var y1;\n      var x2;\n      var y2;\n      var cpx1;\n      var cpy1;\n      var cpx2;\n      var cpy2;\n      curve.shape.extent = Math.max(1, edgeLayout.dy);\n      curve.shape.orient = orient;\n\n      if (orient === 'vertical') {\n        x1 = (dragX1 != null ? dragX1 * width : n1Layout.x) + edgeLayout.sy;\n        y1 = (dragY1 != null ? dragY1 * height : n1Layout.y) + n1Layout.dy;\n        x2 = (dragX2 != null ? dragX2 * width : n2Layout.x) + edgeLayout.ty;\n        y2 = dragY2 != null ? dragY2 * height : n2Layout.y;\n        cpx1 = x1;\n        cpy1 = y1 * (1 - curvature) + y2 * curvature;\n        cpx2 = x2;\n        cpy2 = y1 * curvature + y2 * (1 - curvature);\n      } else {\n        x1 = (dragX1 != null ? dragX1 * width : n1Layout.x) + n1Layout.dx;\n        y1 = (dragY1 != null ? dragY1 * height : n1Layout.y) + edgeLayout.sy;\n        x2 = dragX2 != null ? dragX2 * width : n2Layout.x;\n        y2 = (dragY2 != null ? dragY2 * height : n2Layout.y) + edgeLayout.ty;\n        cpx1 = x1 * (1 - curvature) + x2 * curvature;\n        cpy1 = y1;\n        cpx2 = x1 * curvature + x2 * (1 - curvature);\n        cpy2 = y2;\n      }\n\n      curve.setShape({\n        x1: x1,\n        y1: y1,\n        x2: x2,\n        y2: y2,\n        cpx1: cpx1,\n        cpy1: cpy1,\n        cpx2: cpx2,\n        cpy2: cpy2\n      });\n      curve.setStyle(lineStyleModel.getItemStyle()); // Special color, use source node color or target node color\n\n      switch (curve.style.fill) {\n        case 'source':\n          curve.style.fill = edge.node1.getVisual('color');\n          break;\n\n        case 'target':\n          curve.style.fill = edge.node2.getVisual('color');\n          break;\n      }\n\n      graphic.setHoverStyle(curve, edge.getModel('emphasis.lineStyle').getItemStyle());\n      group.add(curve);\n      edgeData.setItemGraphicEl(edge.dataIndex, curve);\n    }); // Generate a rect for each node\n\n    graph.eachNode(function (node) {\n      var layout = node.getLayout();\n      var itemModel = node.getModel();\n      var dragX = itemModel.get('localX');\n      var dragY = itemModel.get('localY');\n      var labelModel = itemModel.getModel('label');\n      var labelHoverModel = itemModel.getModel('emphasis.label');\n      var rect = new graphic.Rect({\n        shape: {\n          x: dragX != null ? dragX * width : layout.x,\n          y: dragY != null ? dragY * height : layout.y,\n          width: layout.dx,\n          height: layout.dy\n        },\n        style: itemModel.getModel('itemStyle').getItemStyle()\n      });\n      var hoverStyle = node.getModel('emphasis.itemStyle').getItemStyle();\n      graphic.setLabelStyle(rect.style, hoverStyle, labelModel, labelHoverModel, {\n        labelFetcher: seriesModel,\n        labelDataIndex: node.dataIndex,\n        defaultText: node.id,\n        isRectText: true\n      });\n      rect.setStyle('fill', node.getVisual('color'));\n      graphic.setHoverStyle(rect, hoverStyle);\n      group.add(rect);\n      nodeData.setItemGraphicEl(node.dataIndex, rect);\n      rect.dataType = 'node';\n    });\n    nodeData.eachItemGraphicEl(function (el, dataIndex) {\n      var itemModel = nodeData.getItemModel(dataIndex);\n\n      if (itemModel.get('draggable')) {\n        el.drift = function (dx, dy) {\n          sankeyView._focusAdjacencyDisabled = true;\n          this.shape.x += dx;\n          this.shape.y += dy;\n          this.dirty();\n          api.dispatchAction({\n            type: 'dragNode',\n            seriesId: seriesModel.id,\n            dataIndex: nodeData.getRawIndex(dataIndex),\n            localX: this.shape.x / width,\n            localY: this.shape.y / height\n          });\n        };\n\n        el.ondragend = function () {\n          sankeyView._focusAdjacencyDisabled = false;\n        };\n\n        el.draggable = true;\n        el.cursor = 'move';\n      }\n\n      el.highlight = function () {\n        this.trigger('emphasis');\n      };\n\n      el.downplay = function () {\n        this.trigger('normal');\n      };\n\n      el.focusNodeAdjHandler && el.off('mouseover', el.focusNodeAdjHandler);\n      el.unfocusNodeAdjHandler && el.off('mouseout', el.unfocusNodeAdjHandler);\n\n      if (itemModel.get('focusNodeAdjacency')) {\n        el.on('mouseover', el.focusNodeAdjHandler = function () {\n          if (!sankeyView._focusAdjacencyDisabled) {\n            sankeyView._clearTimer();\n\n            api.dispatchAction({\n              type: 'focusNodeAdjacency',\n              seriesId: seriesModel.id,\n              dataIndex: el.dataIndex\n            });\n          }\n        });\n        el.on('mouseout', el.unfocusNodeAdjHandler = function () {\n          if (!sankeyView._focusAdjacencyDisabled) {\n            sankeyView._dispatchUnfocus(api);\n          }\n        });\n      }\n    });\n    edgeData.eachItemGraphicEl(function (el, dataIndex) {\n      var edgeModel = edgeData.getItemModel(dataIndex);\n      el.focusNodeAdjHandler && el.off('mouseover', el.focusNodeAdjHandler);\n      el.unfocusNodeAdjHandler && el.off('mouseout', el.unfocusNodeAdjHandler);\n\n      if (edgeModel.get('focusNodeAdjacency')) {\n        el.on('mouseover', el.focusNodeAdjHandler = function () {\n          if (!sankeyView._focusAdjacencyDisabled) {\n            sankeyView._clearTimer();\n\n            api.dispatchAction({\n              type: 'focusNodeAdjacency',\n              seriesId: seriesModel.id,\n              edgeDataIndex: el.dataIndex\n            });\n          }\n        });\n        el.on('mouseout', el.unfocusNodeAdjHandler = function () {\n          if (!sankeyView._focusAdjacencyDisabled) {\n            sankeyView._dispatchUnfocus(api);\n          }\n        });\n      }\n    });\n\n    if (!this._data && seriesModel.get('animation')) {\n      group.setClipPath(createGridClipShape(group.getBoundingRect(), seriesModel, function () {\n        group.removeClipPath();\n      }));\n    }\n\n    this._data = seriesModel.getData();\n  },\n  dispose: function () {\n    this._clearTimer();\n  },\n  _dispatchUnfocus: function (api) {\n    var self = this;\n\n    this._clearTimer();\n\n    this._unfocusDelayTimer = setTimeout(function () {\n      self._unfocusDelayTimer = null;\n      api.dispatchAction({\n        type: 'unfocusNodeAdjacency',\n        seriesId: self._model.id\n      });\n    }, 500);\n  },\n  _clearTimer: function () {\n    if (this._unfocusDelayTimer) {\n      clearTimeout(this._unfocusDelayTimer);\n      this._unfocusDelayTimer = null;\n    }\n  },\n  focusNodeAdjacency: function (seriesModel, ecModel, api, payload) {\n    var data = seriesModel.getData();\n    var graph = data.graph;\n    var dataIndex = payload.dataIndex;\n    var itemModel = data.getItemModel(dataIndex);\n    var edgeDataIndex = payload.edgeDataIndex;\n\n    if (dataIndex == null && edgeDataIndex == null) {\n      return;\n    }\n\n    var node = graph.getNodeByIndex(dataIndex);\n    var edge = graph.getEdgeByIndex(edgeDataIndex);\n    graph.eachNode(function (node) {\n      fadeOutItem(node, nodeOpacityPath, 0.1);\n    });\n    graph.eachEdge(function (edge) {\n      fadeOutItem(edge, lineOpacityPath, 0.1);\n    });\n\n    if (node) {\n      fadeInItem(node, hoverNodeOpacityPath);\n      var focusNodeAdj = itemModel.get('focusNodeAdjacency');\n\n      if (focusNodeAdj === 'outEdges') {\n        zrUtil.each(node.outEdges, function (edge) {\n          if (edge.dataIndex < 0) {\n            return;\n          }\n\n          fadeInItem(edge, hoverLineOpacityPath);\n          fadeInItem(edge.node2, hoverNodeOpacityPath);\n        });\n      } else if (focusNodeAdj === 'inEdges') {\n        zrUtil.each(node.inEdges, function (edge) {\n          if (edge.dataIndex < 0) {\n            return;\n          }\n\n          fadeInItem(edge, hoverLineOpacityPath);\n          fadeInItem(edge.node1, hoverNodeOpacityPath);\n        });\n      } else if (focusNodeAdj === 'allEdges') {\n        zrUtil.each(node.edges, function (edge) {\n          if (edge.dataIndex < 0) {\n            return;\n          }\n\n          fadeInItem(edge, hoverLineOpacityPath);\n          edge.node1 !== node && fadeInItem(edge.node1, hoverNodeOpacityPath);\n          edge.node2 !== node && fadeInItem(edge.node2, hoverNodeOpacityPath);\n        });\n      }\n    }\n\n    if (edge) {\n      fadeInItem(edge, hoverLineOpacityPath);\n      fadeInItem(edge.node1, hoverNodeOpacityPath);\n      fadeInItem(edge.node2, hoverNodeOpacityPath);\n    }\n  },\n  unfocusNodeAdjacency: function (seriesModel, ecModel, api, payload) {\n    var graph = seriesModel.getGraph();\n    graph.eachNode(function (node) {\n      fadeOutItem(node, nodeOpacityPath);\n    });\n    graph.eachEdge(function (edge) {\n      fadeOutItem(edge, lineOpacityPath);\n    });\n  }\n}); // Add animation to the view\n\n\nfunction createGridClipShape(rect, seriesModel, cb) {\n  var rectEl = new graphic.Rect({\n    shape: {\n      x: rect.x - 10,\n      y: rect.y - 10,\n      width: 0,\n      height: rect.height + 20\n    }\n  });\n  graphic.initProps(rectEl, {\n    shape: {\n      width: rect.width + 20\n    }\n  }, seriesModel, cb);\n  return rectEl;\n}\n\nmodule.exports = _default;"]},"metadata":{},"sourceType":"script"}